
@{
    ViewBag.Title = "TaskList";
    Layout = "~/Areas/app/Views/Shared/_LayoutMain.cshtml";
}

<div id="__FEEDBACKMESSAGEPLACE" style="display:none;"></div>
<div id="twInnerContainer" class="null">
    <script>$("#ISSUES_MENU").addClass('selected');</script>

    <div class="rightColumn noprint">


        <div class="tools">
            <div class="toolsElement">
                <button type="button" class="button noprint    first" id="domId_646043007" style="" onclick="addIssue();return false; "><span class='teamworkIcon withLabel'>P</span>创建问题</button>

            </div><div class="toolsElement">
                <span class="menuArrow" onclick="bjs_showMenuDiv('divdomo_domId_399732747', 'domId_367499417');  ">
                    <button type="button" class="button noprint  icon  " id="domId_367499417" style="" title="导入/导出的问题" onclick=";return false; "><span class='teamworkIcon '>I</span></button>


                </span>

                <div id="divdomo_domId_399732747" class="divomo "
                     style=" position: absolute;left:-10000px; top:-10000px;">

                    <div class="divomoArrow"></div>

                    <div>
                        <button type="button" class="button noprint textual   lreq20 lreqLabel" id="domId_979431013" style="" onClick="stopBubble(event);saveFormValues('issueMultiEditor');  obj('issueMultiEditorCM').value='EXPORT';obj('issueMultiEditorBUTTON_ID').value='domId_979431013';obj('issueMultiEditor').action='/commons/tools/exportXLS.jsp'; try {obj('issueMultiEditor').submit();} catch(e){};restoreFormValues('issueMultiEditor');  ">导出到Excel</button>

                    </div>
                </div>
            </div><div class="toolsElement">
                <span class="menuArrow" onclick="bjs_showMenuDiv('divdomo_domId_692279093', 'domId_312829907');  ">
                    <button type="button" class="button noprint  icon  " id="domId_312829907" style="" title="打印" onclick=";return false; "><span class='teamworkIcon '>p</span></button>


                </span>

                <div id="divdomo_domId_692279093" class="divomo "
                     style=" position: absolute;left:-10000px; top:-10000px;">

                    <div class="divomoArrow"></div>

                    <div>
                        <button type="button" class="button noprint textual   " id="domId_68316605" style="" onclick="submitInBlack('issueMultiEditor','/applications/teamwork/issue/issueListPrint.jsp');return false; ">打印</button>

                        <hr><button type="button" class="button noprint textual   lreq30 lreqLabel" id="domId_1440912737" style="" onClick="stopBubble(event);saveFormValues('issueMultiEditor');  obj('issueMultiEditorCM').value='FN';obj('issueMultiEditorreportName').value='issueListCompact';obj('issueMultiEditor').target='_blank'; obj('issueMultiEditor').action='/applications/teamwork/issue/issueIReportHelper.jsp'; try {obj('issueMultiEditor').submit();} catch(e){};restoreFormValues('issueMultiEditor');  ">issue  list  compact</button>

                    </div>
                </div>
            </div>

        </div>

        <div class="rightColumnInner">



            <div class="noprint filters">
                <h2>我的过滤器...</h2>
                <div class="customSavedFilters" formId="issueMultiEditor" category="ISSUEFILTER" id="issueLSF">
                    <input type="hidden" name="FLNMSEL" id="FLNMSEL">
                    <input type="hidden" name="FLCAT" id="FLCAT" value="ISSUEFILTER">
                    <input type="hidden" name="FLNM" id="FLNM" value="">
                </div>
                <script type="text/javascript">
                    $(function () {
                        $("#issueMultiEditor").append($("#issueLSF input")); //sposta gli input dentro il form
                        var bts = [];
                        var div = $("#issueLSF");
                        for (var i = 0; i < bts.length; i++) {
                            div.append(lsfCreateButton(bts[i]));
                        }
                    });
                </script>



                <div class="separator"></div><a class="button  textual   " id="domId_1965437994" style="" href="/app/issue/issuelist?V_ID=994932704&CM=FN&FLNM=PF_MY_TODAY_OPEN_ISSUES">我今天要做的事情</a>

                <a class="button  textual  focused " id="domId_1526280586" style="" href="/app/issue/issuelist?V_ID=790908830&CM=FN&FLNM=PF_MY_OPEN_ISSUES">待解决的问题</a>

                <a class="button  textual   " id="domId_2028414527" style="" href="/app/issue/issuelist?V_ID=685147703&CM=FN&FLNM=PF_MY_EXPIRED_ISSUES">我的问题过期</a>

                <a class="button  textual   " id="domId_470129107" style="" href="/app/issue/issuelist?V_ID=1882273569&CM=FN&FLNM=PF_MY_OPEN_SEVERE_ISSUES">我已发现的严重问题</a>

                <a class="button  textual   " id="domId_790270226" style="" href="/app/issue/issuelist?V_ID=1209978415&CM=FN&FLNM=PF_MY_INSERTED_ISSUES">我感兴趣的问题</a>

                <a class="button  textual   " id="domId_1584567462" style="" href="/app/issue/issuelist?V_ID=247198185&CM=FN&FLNM=PF_ISSUES_OPENED_RECENTLY">最近出现的问题</a>

                <a class="button  textual   " id="domId_1426521997" style="" href="/app/issue/issuelist?V_ID=478786697&CM=FN&FLNM=PF_ISSUES_CLOSED_RECENTLY">最近关闭的问题</a>

                <a class="button  textual   " id="domId_346791170" style="" href="/app/issue/issuelist?V_ID=965037809&CM=FN&FLNM=PF_LONG_STANDING_ISSUES">长期问题</a>

                <a class="button  textual   " id="domId_1593953719" style="" href="/app/issue/issuelist?V_ID=1288133569&CM=FN&FLNM=PF_OPEN_SEVERE_ISSUES">开放的严重问题</a>

                <a class="button  textual   " id="domId_878248776" style="" href="/app/issue/issuelist?V_ID=933045277&CM=FN&FLNM=PF_RECENTLY_USED">最近浏览过的</a>

            </div>
        </div>
    </div>

    <div class="mainColumn">

        <h1 class="filterTitle" defaultTitle="问题列表">
            待解决的问题
        </h1>





        <form enctype="application/x-www-form-urlencoded" method="POST"
              action="/app/issue/issuelist" name="issueMultiEditor" alertOnChange="true" id="issueMultiEditor"
              savedAction="" savedTarget="">
            <input type="hidden" id="issueMultiEditorV_ID" name="V_ID" value="1888888150" savedValue="">
            <input type="hidden" id="issueMultiEditorCM" name="CM" value="FN" savedValue="">
            <input type="hidden" id="issueMultiEditorBUTTON_ID" name="BUTTON_ID" value="" savedValue="">
            <input type="hidden" id="issueMultiEditorreportName" name="reportName" value="" savedValue="">
            <input type="hidden" id="issueMultiEditoroutType" name="outType" value="" savedValue="">




            <div class="filterBar withButtons clearfix">


                <div class="filterActiveElements"></div>

                <div class="filterInactiveElements">
                    <div class="filterElement  ">
                        <label for="domId_1604362432_txt">任务</label> &nbsp;&nbsp;&nbsp;&nbsp;<input type=hidden name="FLT_TASK_ISSUE_SHOW_CHILDREN" id="FLT_TASK_ISSUE_SHOW_CHILDREN" size=1 autocomplete='off' maxlength=255 data-checkfield value="no"><input type="checkbox" id="ck_FLT_TASK_ISSUE_SHOW_CHILDREN" name="ck_FLT_TASK_ISSUE_SHOW_CHILDREN" value="yes"
                                                                                                                                                                                                                                                                onClick="$(this).prevAll('[type=hidden]:first').val(this.checked ? 'yes' : 'no');">
                        <label>包含子任务的问题</label><br><input type=text name="FLT_ISSUE_TASK_txt" id="FLT_ISSUE_TASK_txt" size=25 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,true );" onKeyDown="manageKeyEvent ($(this),event,false,true);" onKeyPress="stopKeyEvent(event);" value=""><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="FLT_ISSUE_TASK" id="FLT_ISSUE_TASK" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="">

                    </div>



                    <div class="filterElement filterDefault"><label for="ISSUE_DESCRIPTION" class=" ">描述</label><br><input type=TEXT name="FLT_ISSUE_DESCRIPTION" id="ISSUE_DESCRIPTION" size=30 class="formElements qbe" autocomplete='off' maxlength=255 value=""></div>
                    <div class="filterElement  ">
                        <label for="domId_749401112_txt">分工给</label> &nbsp;&nbsp;&nbsp;&nbsp; <input type=hidden name="FLT_ISSUE_UNASSIGNED" id="FLT_ISSUE_UNASSIGNED" size=1 autocomplete='off' maxlength=255 data-checkfield value="no"><input type="checkbox" id="ck_FLT_ISSUE_UNASSIGNED" name="ck_FLT_ISSUE_UNASSIGNED" value="yes"
                                                                                                                                                                                                                                                 onClick="$(this).prevAll('[type=hidden]:first').val(this.checked ? 'yes' : 'no');if ($(this).prop('checked')){removeSmartComboEntry('FLT_ISSUE_ASSIGNED_TO')}">
                        <label>未分工</label><br>
                        <script>
                            function letSubmitFLT_ISSUE_ASSIGNED_TO() {
                                $('#ck_FLT_ISSUE_UNASSIGNED').prop('checked', false); $('#FLT_ISSUE_UNASSIGNED').val('no');
                            }
                        </script><input type=text name="FLT_ISSUE_ASSIGNED_TO_txt" id="FLT_ISSUE_ASSIGNED_TO_txt" size=30 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,true );" onKeyDown="manageKeyEvent ($(this),event,false,true);" onKeyPress="stopKeyEvent(event);" value="Wing Dream"><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="FLT_ISSUE_ASSIGNED_TO" id="FLT_ISSUE_ASSIGNED_TO" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="15089">

                    </div>

                    <div class="filterElement  ">
                        <label for="domId_1863750379_txt">分工给 公司/部门</label> &nbsp;&nbsp;&nbsp;&nbsp; <input type=hidden name="FLT_COMPANY_ISSUE_SHOW_CHILDREN" id="FLT_COMPANY_ISSUE_SHOW_CHILDREN" size=1 autocomplete='off' maxlength=255 data-checkfield value="no"><input type="checkbox" id="ck_FLT_COMPANY_ISSUE_SHOW_CHILDREN" name="ck_FLT_COMPANY_ISSUE_SHOW_CHILDREN" value="yes"
                                                                                                                                                                                                                                                                              onClick="$(this).prevAll('[type=hidden]:first').val(this.checked ? 'yes' : 'no');">
                        <label>整支球队</label><br><input type=text name="FLT_ISSUE_ASSIGNED_COMPANY_txt" id="FLT_ISSUE_ASSIGNED_COMPANY_txt" size=30 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,true );" onKeyDown="manageKeyEvent ($(this),event,false,true);" onKeyPress="stopKeyEvent(event);" value=""><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="FLT_ISSUE_ASSIGNED_COMPANY" id="FLT_ISSUE_ASSIGNED_COMPANY" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="">

                    </div>



                    <div class="filterElement centered">
                        <input type=hidden name="FLT_ISSUE_INHISTORY" id="FLT_ISSUE_INHISTORY" size=1 autocomplete='off' maxlength=255 data-checkfield value="no"><input type="checkbox" id="ck_FLT_ISSUE_INHISTORY" name="ck_FLT_ISSUE_INHISTORY" value="yes" title="搜索联系人和记事的历史"
                                                                                                                                                                         onClick="$(this).prevAll('[type=hidden]:first').val(this.checked ? 'yes' : 'no');">
                        <label title="搜索联系人和记事的历史" for="ck_FLT_ISSUE_INHISTORY" title="搜索联系人和记事的历史">历史</label>
                    </div>
                    <div class="filterElement">
                        <label for="FLT_ISSUE_ASSIGNED_BY_txt" class=" ">分工创建者</label><br><input type=text name="FLT_ISSUE_ASSIGNED_BY_txt" id="FLT_ISSUE_ASSIGNED_BY_txt" size=25 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,false );" onKeyDown="manageKeyEvent ($(this),event,false,false);" onKeyPress="stopKeyEvent(event);" value=""><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="FLT_ISSUE_ASSIGNED_BY" id="FLT_ISSUE_ASSIGNED_BY" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="">
                    </div>
                    <div class="filterElement"><label for="ISSUE_ESTIMATED" class=" ">预估工期</label><br><input type=TEXT name="FLT_ISSUE_ESTIMATED" id="ISSUE_ESTIMATED" size=10 class="formElements qbe" autocomplete='off' maxlength=255 value=""></div>
                    <div class="filterElement">

                        <script type="text/javascript">

                            (function () {
                                var cvd = { values: [{ "code": "BEHAVES_AS_OPEN_ALL", "color": "#00ff00", "value": "- 所有打开状态 -", "enabled": true, "textColor": "#FFFFFF", "index": 1 }, { "code": "BEHAVES_AS_CLOSED_ALL", "color": "#0000ff", "value": "- 所有关闭状态 -", "enabled": true, "textColor": "#FFFFFF", "index": 2 }, { "code": "13720", "color": "#3BBF67", "value": "open", "enabled": true, "textColor": "#FFFFFF", "index": 3 }, { "code": "13721", "color": "#6EBEF4", "value": "closed", "enabled": true, "textColor": "#000000", "index": 4 }, { "code": "13722", "color": "#763A96", "value": "aborted", "enabled": true, "textColor": "#FFFFFF", "index": 5 }, { "code": "", "color": "gray", "value": "- 选择 -", "enabled": true, "textColor": "#FFFFFF", "index": 6 }] };


                                _colorValueData["FLT_ISSUE_STATUS"] = cvd;

                            })();
                        </script>



                        <label for="domId_1429183541">问题状态</label><br> <div class="cvcComponent cvcMultiSelect cvcDisplayValue cvcShowOpener " style="cursor:pointer;" cvcType="FLT_ISSUE_STATUS" displayValue='true'>
                            <input type=hidden name="FLT_ISSUE_STATUS" id="FLT_ISSUE_STATUS" size=2 class="formElements" autocomplete='off' maxlength=255 value="BEHAVES_AS_OPEN_ALL"><div class="cvcColorSquare" onClick="cvc_clickColValSel($(this),event);">
                                <div class="cvcStatuses ellipsis">
                                    <div class="cvcSelBox " title="- 所有打开状态 -" code="BEHAVES_AS_OPEN_ALL"
                                         style=" "><span class="teamworkIcon" style="color:#00ff00">&#169;</span><span class="cvcDescription">- 所有打开状态 -</span></div>
                                </div><span class="teamworkIcon menuArrow">&ugrave;</span>
                            </div>

                        </div>
                    </div>
                    <div class="filterElement">
                        <label for="FLT_ISSUE_STATUS_LAST_CHANGE" class=" ">状态最后变更</label><br><input type=text name="FLT_ISSUE_STATUS_LAST_CHANGE" id="FLT_ISSUE_STATUS_LAST_CHANGE" size=8 class="formElements dateField qbe" autocomplete='off' maxlength=255 format="yyyy-M-d" value="" entryType="DATE" maxValue="3020-11-19" minValue="1020-10-29"><span title="日历" id="FLT_ISSUE_STATUS_LAST_CHANGEs_inputDate" class="teamworkIcon openCalendar"
                                                                                                                                                                                                                                                                                                                                                              onclick="var inp=$(this).prevAll(':input:first');$(this).dateField({inputField:inp,dateFormat:inp.attr('format'),isSearchField:true,minDate:inp.attr('minValue'),maxDate:inp.attr('maxValue'),disableHolidays:false});">m</span>

                    </div>
                    <div class="filterElement">
                        <label for="FLT_ISSUE_DATE_SIGNALLED" class=" ">被告知日期</label><br><input type=text name="FLT_ISSUE_DATE_SIGNALLED" id="FLT_ISSUE_DATE_SIGNALLED" size=8 class="formElements dateField qbe" autocomplete='off' maxlength=255 format="yyyy-M-d" value="" entryType="DATE" maxValue="3020-11-19" minValue="1020-10-29"><span title="日历" id="FLT_ISSUE_DATE_SIGNALLEDs_inputDate" class="teamworkIcon openCalendar"
                                                                                                                                                                                                                                                                                                                                                 onclick="var inp=$(this).prevAll(':input:first');$(this).dateField({inputField:inp,dateFormat:inp.attr('format'),isSearchField:true,minDate:inp.attr('minValue'),maxDate:inp.attr('maxValue'),disableHolidays:false});">m</span>

                    </div>
                    <div class="filterElement">
                        <label for="FLT_ISSUE_DATE_CLOSE_BY" class=" ">截止日期</label><br><input type=text name="FLT_ISSUE_DATE_CLOSE_BY" id="FLT_ISSUE_DATE_CLOSE_BY" size=8 class="formElements dateField qbe" autocomplete='off' maxlength=255 format="yyyy-M-d" value="" entryType="DATE" maxValue="3020-11-19" minValue="1020-10-29"><span title="日历" id="FLT_ISSUE_DATE_CLOSE_BYs_inputDate" class="teamworkIcon openCalendar"
                                                                                                                                                                                                                                                                                                                                             onclick="var inp=$(this).prevAll(':input:first');$(this).dateField({inputField:inp,dateFormat:inp.attr('format'),isSearchField:true,minDate:inp.attr('minValue'),maxDate:inp.attr('maxValue'),disableHolidays:false});">m</span>

                    </div>
                    <div class="filterElement">
                        <label for="FLT_ISSUE_LAST_MODIFIED" class=" ">最后编辑</label><br><input type=text name="FLT_ISSUE_LAST_MODIFIED" id="FLT_ISSUE_LAST_MODIFIED" size=8 class="formElements dateField qbe" autocomplete='off' maxlength=255 format="yyyy-M-d" value="" entryType="DATE" maxValue="3020-11-19" minValue="1020-10-29"><span title="日历" id="FLT_ISSUE_LAST_MODIFIEDs_inputDate" class="teamworkIcon openCalendar"
                                                                                                                                                                                                                                                                                                                                             onclick="var inp=$(this).prevAll(':input:first');$(this).dateField({inputField:inp,dateFormat:inp.attr('format'),isSearchField:true,minDate:inp.attr('minValue'),maxDate:inp.attr('maxValue'),disableHolidays:false});">m</span>

                    </div>
                    <div class="filterElement">

                        <script type="text/javascript">

                            (function () {
                                var cvd = { values: [{ "code": "", "color": "gray", "value": "- 选择 -", "enabled": true, "textColor": "#FFFFFF", "index": 1 }, { "code": "05_GRAVITY_BLOCK", "color": "#DB2727", "value": "中断", "enabled": true, "textColor": "#FFFFFF", "index": 2 }, { "code": "04_GRAVITY_CRITICAL", "color": "#8C6044", "value": "关键的", "enabled": true, "textColor": "#FFFFFF", "index": 3 }, { "code": "03_GRAVITY_HIGH", "color": "#F9791C", "value": "高", "enabled": true, "textColor": "#FFFFFF", "index": 4 }, { "code": "02_GRAVITY_MEDIUM", "color": "#F9C154", "value": "中", "enabled": true, "textColor": "#000000", "index": 5 }, { "code": "01_GRAVITY_LOW", "color": "#EEEEEE", "value": "低", "enabled": true, "textColor": "#000000", "index": 6 }] };


                                _colorValueData["ISSUEGRAVITYFILTER"] = cvd;

                            })();
                        </script>



                        <label for="domId_1514277317">级别</label><br> <div class="cvcComponent cvcMultiSelect cvcDisplayValue cvcShowOpener " style="cursor:pointer;" cvcType="ISSUEGRAVITYFILTER" displayValue='true'>
                            <input type=hidden name="FLT_ISSUE_GRAVITY" id="FLT_ISSUE_GRAVITY" size=2 class="formElements" autocomplete='off' maxlength=255 value=""><div class="cvcColorSquare" onClick="cvc_clickColValSel($(this),event);">
                                <div class="cvcStatuses ellipsis">
                                    <div class="cvcSelBox " title="- 选择 -" code=""
                                         style=" "><span class="teamworkIcon" style="color:gray">&#169;</span><span class="cvcDescription">- 选择 -</span></div>
                                </div><span class="teamworkIcon menuArrow">&ugrave;</span>
                            </div>

                        </div>
                    </div>
                    <div class="filterElement centered">
                        <input type=hidden name="RECENTLY_USED" id="RECENTLY_USED" size=1 autocomplete='off' maxlength=255 data-checkfield value="no"><input type="checkbox" id="ck_RECENTLY_USED" name="ck_RECENTLY_USED" value="yes"
                                                                                                                                                             onClick="$(this).prevAll('[type=hidden]:first').val(this.checked ? 'yes' : 'no');">
                        &nbsp;<label for="ck_RECENTLY_USED">最近浏览过的</label>&nbsp;
                    </div>
                    <div class="filterElement"><label for="FLT_ISSUE_EXTERNAL_REQUESTER" class=" ">外部请求者的电子邮件</label><br><input type=email name="FLT_ISSUE_EXTERNAL_REQUESTER" id="FLT_ISSUE_EXTERNAL_REQUESTER" size=20 class="formElements qbe" autocomplete='off' maxlength=255 value="" entryType="EMAIL"></div>

                    <div class="filterElement">
                        <label for="CUST_ID_txt" class=" ">顾客</label><br><input type=text name="CUST_ID_txt" id="CUST_ID_txt" size=30 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,false );" onKeyDown="manageKeyEvent ($(this),event,false,false);" onKeyPress="stopKeyEvent(event);" value=""><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="CUST_ID" id="CUST_ID" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="">
                    </div>
                    <div class="filterElement">
                        <label for="PROJECTMANAGER_ID_txt" class=" ">Project manager</label><br><input type=text name="PROJECTMANAGER_ID_txt" id="PROJECTMANAGER_ID_txt" size=30 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,false );" onKeyDown="manageKeyEvent ($(this),event,false,false);" onKeyPress="stopKeyEvent(event);" value=""><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="PROJECTMANAGER_ID" id="PROJECTMANAGER_ID" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="">
                    </div>
                    <div class="filterElement">

                        <script type="text/javascript">

                            (function () {
                                var cvd = { values: [{ "code": "", "color": "gray", "value": "- 选择 -", "enabled": true, "textColor": "#FFFFFF", "index": 1 }] };


                                _colorValueData["TTMS"] = cvd;

                            })();
                        </script>



                        <label for="domId_1469387003">任务类型</label><br> <div class="cvcComponent noBall cvcMultiSelect cvcDisplayValue cvcShowOpener " style="cursor:pointer;" cvcType="TTMS" displayValue='true'>
                            <input type=hidden name="ISSUE_TASK_TYPE" id="ISSUE_TASK_TYPE" size=2 class="formElements" autocomplete='off' maxlength=255 value=""><div class="cvcColorSquare" onClick="cvc_clickColValSel($(this),event);">
                                <div class="cvcStatuses ellipsis">
                                    <div class="cvcSelBox " title="- 选择 -" code=""
                                         style=" "><span class="teamworkIcon" style="color:gray">&#169;</span><span class="cvcDescription">- 选择 -</span></div>
                                </div><span class="teamworkIcon menuArrow">&ugrave;</span>
                            </div>

                        </div>
                    </div>
                    <div class="filterElement">

                        <script type="text/javascript">

                            (function () {
                                var cvd = { values: [{ "code": "STATUS_ACTIVE", "color": "#3BBF67", "value": "进行中", "enabled": true, "textColor": "#FFFFFF", "index": 1 }, { "code": "STATUS_WAITING", "color": "#F79136", "value": "等候", "enabled": true, "textColor": "#FFFFFF", "index": 2 }, { "code": "STATUS_SUSPENDED", "color": "#F9C154", "value": "暂停", "enabled": true, "textColor": "#000000", "index": 3 }, { "code": "STATUS_DONE", "color": "#6EBEF4", "value": "完成", "enabled": true, "textColor": "#000000", "index": 4 }, { "code": "STATUS_FAILED", "color": "#763A96", "value": "失败", "enabled": true, "textColor": "#FFFFFF", "index": 5 }, { "code": "STATUS_UNDEFINED", "color": "#dededf", "value": "未定义", "enabled": true, "textColor": "#000000", "index": 6 }, { "code": "", "color": "gray", "value": "全部", "enabled": true, "textColor": "#FFFFFF", "index": 7 }] };


                                _colorValueData["ISSUETASKSTATUSFILTER"] = cvd;

                            })();
                        </script>



                        <label for="domId_1118638163">任务状态</label><br> <div class="cvcComponent cvcMultiSelect cvcDisplayValue cvcShowOpener " style="cursor:pointer;" cvcType="ISSUETASKSTATUSFILTER" displayValue='true'>
                            <input type=hidden name="FLT_ISSUE_TASK_STATUS" id="FLT_ISSUE_TASK_STATUS" size=2 class="formElements" autocomplete='off' maxlength=255 value="STATUS_ACTIVE"><div class="cvcColorSquare" onClick="cvc_clickColValSel($(this),event);">
                                <div class="cvcStatuses ellipsis">
                                    <div class="cvcSelBox " title="进行中" code="STATUS_ACTIVE"
                                         style=" "><span class="teamworkIcon" style="color:#3BBF67">&#169;</span><span class="cvcDescription">进行中</span></div>
                                </div><span class="teamworkIcon menuArrow">&ugrave;</span>
                            </div>

                        </div>
                    </div>
                    <div class="filterElement"><label for="ISSUE_ID" class=" ">Id (db)</label><br><input type=TEXT name="ISSUE_ID" id="ISSUE_ID" size=8 class="formElements qbe" autocomplete='off' maxlength=255 value=""></div>
                    <div class="filterElement"><label for="FLT_ISSUE_TAGS" class=" ">标签</label><br><input type=text name="FLT_ISSUE_TAGS" id="FLT_ISSUE_TAGS" size=20 class="formElements tagBox" autocomplete='off' maxlength=255 autocomplete='off' taggableClass="com.twproject.task.Issue" maxResult="30" tagPropertyName="tags" areaId="5819" value=""></div>
                    <div class="filterElement centered">
                        <input type=hidden name="FLT_ISSUE_HAVING_WRKLG" id="FLT_ISSUE_HAVING_WRKLG" size=1 autocomplete='off' maxlength=255 data-checkfield value="no"><input type="checkbox" id="ck_FLT_ISSUE_HAVING_WRKLG" name="ck_FLT_ISSUE_HAVING_WRKLG" value="yes"
                                                                                                                                                                               onClick="$(this).prevAll('[type=hidden]:first').val(this.checked ? 'yes' : 'no');">
                        &nbsp;<label for="ck_FLT_ISSUE_HAVING_WRKLG">已有工作记录的问题</label>&nbsp;
                    </div>





                    <div class="filterElement ">
                        <label for="FLT_AREA" class=" ">域</label><br><SELECT NAME="FLT_AREA" id="FLT_AREA" CLASS="formElements">
                            <option value="">- 选择 -</option>
                            <option value="5819">梦想飞扬</option>
                        </SELECT>
                    </div>



                </div>





                <div class="filterButtons">
                    <div class="filterButtonsElement filterAdd">
                        <span class="button" id="filterSelectorOpener" title="更多的过滤器" onclick="bjs_showMenuDiv('filterSelectorBox', 'filterSelectorOpener');"><span class="teamworkIcon">f</span></span>
                    </div>
                    <div class="filterButtonsElement filterSearch">
                        <button type="button" class="button noprint    " id="domId_997423351" style="" onclick="dataTableSearchClick('ISSUEFILTER');return false; " data-dtid="ISSUEFILTER">搜索</button>

                    </div>

                    <div class="filterActions">
                        <div class="filterButtonsElement filterSave" style="">
                            <span onclick="lsfOpenEditor($(this))" lsfId="issueLSF" title="保存这个搜索" class="button textual">保存这个搜索</span>
                        </div>
                        <div class="filterButtonsElement filterHelp">
                            <button type="button" class="button noprint textual   " id="domId_929613332" style="" title="如何使用示例查询（QBE）组成强大的搜索.<br>您可以保存您的搜索条件以便将来使用." onclick="openBlackPopup('/commons/help/qbe.jsp?V_ID=436911775','800px','700px');return false; ">Help</button>

                        </div>
                    </div>

                </div>
            </div>
            <script src="/commons/js/filterEngine.js"></script>



            <style type="text/css">
                .table.dataTable .dataTableBody td.priority { position: relative; }



                .table.dataTable .dataTableBody tr.issueRow[gravity="05_GRAVITY_BLOCK"] td.priority { background-color: #DB2727; }


                .table.dataTable .dataTableBody tr.issueRow[gravity="04_GRAVITY_CRITICAL"] td.priority { background-color: #8C6044; }


                .table.dataTable .dataTableBody tr.issueRow[gravity="03_GRAVITY_HIGH"] td.priority { background-color: #F9791C; }


                .table.dataTable .dataTableBody tr.issueRow[gravity="02_GRAVITY_MEDIUM"] td.priority { background-color: #F9C154; }


                .table.dataTable .dataTableBody tr.issueRow[gravity="01_GRAVITY_LOW"] td.priority { background-color: #EEEEEE; }
            </style>


            <script type="text/javascript">

                (function () {
                    var cvd = { values: [{ "code": "13720", "color": "#3BBF67", "value": "open", "enabled": true, "textColor": "#FFFFFF", "index": 1 }, { "code": "13721", "color": "#6EBEF4", "value": "closed", "enabled": true, "textColor": "#000000", "index": 2 }, { "code": "13722", "color": "#763A96", "value": "aborted", "enabled": true, "textColor": "#FFFFFF", "index": 3 }] };


                    var callback = function (hidden, data) {
                        hidden.each(changeStatus);
                    };
                    cvd.callback = callback;

                    _colorValueData["STATUSLINE5819"] = cvd;

                })();
            </script>



            <script type="text/javascript">

                (function () {
                    var cvd = { values: [{ "code": "05_GRAVITY_BLOCK", "color": "#DB2727", "value": "中断", "enabled": true, "textColor": "#FFFFFF", "index": 1 }, { "code": "04_GRAVITY_CRITICAL", "color": "#8C6044", "value": "关键的", "enabled": true, "textColor": "#FFFFFF", "index": 2 }, { "code": "03_GRAVITY_HIGH", "color": "#F9791C", "value": "高", "enabled": true, "textColor": "#FFFFFF", "index": 3 }, { "code": "02_GRAVITY_MEDIUM", "color": "#F9C154", "value": "中", "enabled": true, "textColor": "#000000", "index": 4 }, { "code": "01_GRAVITY_LOW", "color": "#EEEEEE", "value": "低", "enabled": true, "textColor": "#000000", "index": 5 }] };


                    var callback = function (hidden, data) {
                        hidden.each(changeGravity);
                    };
                    cvd.callback = callback;

                    _colorValueData["ISSGRLIN"] = cvd;

                })();
            </script>


        </form>





        <div id="insertStatusNotes" class="notesEditor">
            <label for="HIS_NOTES" class=" ">新增评论</label><br><textarea name="HIS_NOTES" id="HIS_NOTES" COLS="50" ROWS="5" class="formElements" style='height:125px;width:100%' oldValue='1' maxlength=2000 onKeyUp="limitSize(this);" onKeyDown="limitSize(this);" onBlur="limitSize(this);"></textarea><button type="button" class="button noprint    button noprint first small" id="domId_1476061429" style="" onclick="saveStatusNotes($(this));return false; ">保存</button>


            <span class="teamworkIcon issueNotesClose" title="hide" onclick="$(this).closest('.notesEditor').fadeOut();" style="cursor: pointer">x</span>

        </div>



        <div id="insertComment" style="display:none" class="notesEditor">
            <textarea name="HIS_COMMENT" id="HIS_COMMENT" COLS="50" ROWS="2" class="formElements autosize" placeHolder='新增评论' oldValue='1' maxHeight=400 minHeight=125 lineHeight=15></textarea><div style="margin-top: 10px">
                <button type="button" class="button noprint    first" id="domId_1146973636" style="" onclick="saveComment($(this));return false; ">保存</button>

            </div>
        </div>



        <div id="bulkOp" style="display:none;">

            <div id="bulkRowSel"></div>

            <div>
                <button type="button" class="button noprint textual   " id="domId_1372684780" style="" onclick="$(this).confirm(function(){performBulkAction('BULK_CLOSE_ISSUES');},'您确实要关闭选择的问题?');return false; "><span class='teamworkIcon withLabel'>x</span>关闭问题</button>

            </div><div>
                <button type="button" class="button noprint textual   " id="domId_296277739" style="" onclick="openBulkAction('changeGravityAll');return false; "><span class='teamworkIcon withLabel'>h</span>变更严重性</button>

                <br><button type="button" class="button noprint textual   " id="domId_1672865627" style="" onclick="openBulkAction('changeStatusAll');return false; "><span class='teamworkIcon withLabel'>h</span>变更状态</button>

            </div><div>
                <button type="button" class="button noprint textual   " id="domId_996686465" style="" onclick="openBulkAction('moveToTaskAll');return false; "><span class='teamworkIcon withLabel'>y</span>移至任务</button>

                <br><button type="button" class="button noprint textual   " id="domId_936970655" style="" onclick="openBulkAction('moveToResAll');return false; "><span class='teamworkIcon withLabel'>y</span>移至资源</button>

                <br><button type="button" class="button noprint textual   " id="domId_168215134" style="" onclick="openBulkAction('copyToTaskAll');return false; "><span class='teamworkIcon withLabel'>D</span>副本任务</button>

            </div><div>
                <button type="button" class="button noprint textual   " id="domId_1103277686" style="" onclick="$(this).confirm(function(){performBulkAction('BULK_MERGE_ISSUES');},'您确实想要合并选择的问题吗？(仅仅有相同的任务和资源的问题才可以被合并)');return false; "><span class='teamworkIcon withLabel'>q</span>合并</button>

                <br><button type="button" class="button noprint textual   " id="domId_1414260404" style="" onclick="openBulkAction('changeDateAll');return false; "><span class='teamworkIcon withLabel'>m</span>更改日期</button>

            </div><div>
                <button type="button" class="button noprint textual   " id="domId_1125605032" style="" onclick="openBulkAction('addCommentAll');return false; "><span class='teamworkIcon withLabel'>Q</span>新增评论</button>

                <br><button type="button" class="button noprint textual   " id="domId_860326401" style="" onclick="openBulkAction('addTagsAll');return false; "><span class='teamworkIcon withLabel'>B</span>创建标签</button>

            </div><div>
                <button type="button" class="button noprint textual   " id="domId_498426356" style="" onclick="$(this).confirm(function(){performBulkAction('BULK_DEL_ISSUES');},'您确实要移除选择的问题?');return false; "><span class='teamworkIcon withLabel'>&#xa2;</span>移除所选</button>

                <br><button type="button" class="button noprint textual   " id="domId_1865541992" style="" onClick="stopBubble(event);saveFormValues('issueMultiEditor');  obj('issueMultiEditorCM').value='BULK_PRINT';obj('issueMultiEditor').target='_blank'; obj('issueMultiEditor').action='/applications/teamwork/issue/issueListPrint.jsp'; injectSelectedIds();try {obj('issueMultiEditor').submit();} catch(e){};restoreFormValues('issueMultiEditor');  "><span class='teamworkIcon withLabel'>p</span>打印所选</button>

            </div>
        </div>





        <div id="moveToTaskAll" style="display:none;" class="bulkData">
            <h1>
                移至任务
            </h1>
            <table width="100%">
                <tr>
                    <td valign='top' width="330" nowrap>
                        <label for="ISSUE_MOVE_TO_TASK_txt" class="required">设置选择问题的任务*</label><br><input type=text name="ISSUE_MOVE_TO_TASK_txt" id="ISSUE_MOVE_TO_TASK_txt" size=35 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),true,false );" onKeyDown="manageKeyEvent ($(this),event,true,false);" onKeyPress="stopKeyEvent(event);" value="" required="true"><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="ISSUE_MOVE_TO_TASK" id="ISSUE_MOVE_TO_TASK" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="" required="true">
                    </td>
                </tr>
                <tr>
                    <td valign='top'><label for="HIS_NOTES_TSK" class=" ">注释</label><br><textarea name="HIS_NOTES_TSK" id="HIS_NOTES_TSK" COLS="35" ROWS="2" class="formElements" maxlength=2000 onKeyUp="limitSize(this);" onKeyDown="limitSize(this);" onBlur="limitSize(this);"></textarea></td>
                </tr>
                <tr>
                    <td>
                        <br><button type="button" class="button noprint    first" id="domId_1997404104" style="" onclick="performBulkAction('BULK_MOVE_TO_TASK',$(this));return false; ">执行</button>

                    </td>
                </tr>
            </table>
        </div>

        <div id="copyToTaskAll" style="display:none;" class="bulkData">
            <h1>
                副本任务
            </h1>
            <table width="100%">
                <tr>
                    <td valign='top' width="330" nowrap>
                        <label for="ISSUE_COPY_TO_TASK_txt" class="required">设置选择问题的任务*</label><br><input type=text name="ISSUE_COPY_TO_TASK_txt" id="ISSUE_COPY_TO_TASK_txt" size=35 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),true,false );" onKeyDown="manageKeyEvent ($(this),event,true,false);" onKeyPress="stopKeyEvent(event);" value="" required="true"><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="ISSUE_COPY_TO_TASK" id="ISSUE_COPY_TO_TASK" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="" required="true">
                    </td>
                </tr>
                <tr>
                    <td>
                        <br><button type="button" class="button noprint    first" id="domId_122937332" style="" onclick="performBulkAction('BULK_COPY_TO_TASK',$(this));return false; ">执行</button>

                    </td>
                </tr>
            </table>
        </div>

        <div id="moveToResAll" style="display:none;" class="bulkData">
            <h1>
                移至资源
            </h1>
            <table width="100%">
                <tr>
                    <td valign="top" width="330" nowrap>
                        <label for="ISSUE_MOVE_TO_RES_txt" class=" ">设置选择问题的资源</label><br><input type=text name="ISSUE_MOVE_TO_RES_txt" id="ISSUE_MOVE_TO_RES_txt" size=35 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,false );" onKeyDown="manageKeyEvent ($(this),event,false,false);" onKeyPress="stopKeyEvent(event);" value=""><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="ISSUE_MOVE_TO_RES" id="ISSUE_MOVE_TO_RES" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="">
                    </td>
                </tr>
                <tr>
                    <td valign='top'><label for="HIS_NOTES_RES" class=" ">注释</label><br><textarea name="HIS_NOTES_RES" id="HIS_NOTES_RES" COLS="35" ROWS="2" class="formElements" maxlength=2000 onKeyUp="limitSize(this);" onKeyDown="limitSize(this);" onBlur="limitSize(this);"></textarea></td>
                </tr>
                <tr>
                    <td>
                        <br><button type="button" class="button noprint    first" id="domId_353095346" style="" onclick="performBulkAction('BULK_MOVE_TO_RES',$(this));return false; ">执行</button>

                    </td>
                </tr>
            </table>
        </div>

        <div id="changeStatusAll" style="display:none;" class="bulkData">
            <h1>变更状态</h1>
            <table width="100%">
                <tr>
                    <td valign="top" nowrap>

                        <script type="text/javascript">

                            (function () {
                                var cvd = { values: [{ "code": "13720", "color": "#3BBF67", "value": "open", "enabled": true, "textColor": "#FFFFFF", "index": 1 }, { "code": "13721", "color": "#6EBEF4", "value": "closed", "enabled": true, "textColor": "#000000", "index": 2 }, { "code": "13722", "color": "#763A96", "value": "aborted", "enabled": true, "textColor": "#FFFFFF", "index": 3 }] };


                                _colorValueData["STATUS"] = cvd;

                            })();
                        </script>



                        <label for="domId_85236179">问题状态</label><br> <div class="cvcComponent cvcDisplayValue cvcShowOpener " style="cursor:pointer;" cvcType="STATUS" displayValue='true'>
                            <input type=hidden name="ISSUE_STATUS_ALL" id="ISSUE_STATUS_ALL" size=2 class="formElements" autocomplete='off' maxlength=255 value="13720"><div class="cvcColorSquare" onClick="cvc_clickColValSel($(this),event);">
                                <div class="cvcStatuses ellipsis">
                                    <div class="cvcSelBox " title="open" code="13720"
                                         style=" color:#FFFFFF;background-color:#3BBF67"><span class="cvcDescription">open</span></div>
                                </div><span class="teamworkIcon menuArrow">&ugrave;</span>
                            </div>

                        </div>
                    </td>
                </tr>
                <tr>
                    <td valign='top'><label for="HIS_NOTES_ST" class=" ">注释</label><br><textarea name="HIS_NOTES_ST" id="HIS_NOTES_ST" COLS="35" ROWS="2" class="formElements" style='width:100%' maxlength=2000 onKeyUp="limitSize(this);" onKeyDown="limitSize(this);" onBlur="limitSize(this);"></textarea></td>
                </tr>
                <tr>
                    <td>
                        <br><button type="button" class="button noprint    first" id="domId_1061475018" style="" onclick="performBulkAction('BULK_SET_STATUS',$(this));return false; ">执行</button>

                    </td>
                </tr>
            </table>
        </div>

        <div id="changeGravityAll" style="display:none;" class="bulkData">
            <h1>
                变更严重性
            </h1>
            <table width="100%">
                <tr>
                    <td>

                        <script type="text/javascript">

                            (function () {
                                var cvd = { values: [{ "code": "05_GRAVITY_BLOCK", "color": "#DB2727", "value": "中断", "enabled": true, "textColor": "#FFFFFF", "index": 1 }, { "code": "04_GRAVITY_CRITICAL", "color": "#8C6044", "value": "关键的", "enabled": true, "textColor": "#FFFFFF", "index": 2 }, { "code": "03_GRAVITY_HIGH", "color": "#F9791C", "value": "高", "enabled": true, "textColor": "#FFFFFF", "index": 3 }, { "code": "02_GRAVITY_MEDIUM", "color": "#F9C154", "value": "中", "enabled": true, "textColor": "#000000", "index": 4 }, { "code": "01_GRAVITY_LOW", "color": "#EEEEEE", "value": "低", "enabled": true, "textColor": "#000000", "index": 5 }] };


                                _colorValueData["GRAVITY"] = cvd;

                            })();
                        </script>



                        <label for="domId_1063971897">级别</label><br> <div class="cvcComponent cvcDisplayValue cvcShowOpener " style="cursor:pointer;" cvcType="GRAVITY" displayValue='true'>
                            <input type=hidden name="ISSUE_GRAVITY_ALL" id="ISSUE_GRAVITY_ALL" size=2 class="formElements" autocomplete='off' maxlength=255 value="05_GRAVITY_BLOCK"><div class="cvcColorSquare" onClick="cvc_clickColValSel($(this),event);">
                                <div class="cvcStatuses ellipsis">
                                    <div class="cvcSelBox " title="中断" code="05_GRAVITY_BLOCK"
                                         style=" color:#FFFFFF;background-color:#DB2727"><span class="cvcDescription">中断</span></div>
                                </div><span class="teamworkIcon menuArrow">&ugrave;</span>
                            </div>

                        </div>

                    </td>
                </tr>
                <tr>
                    <td valign='top'><label for="HIS_NOTES_ST" class=" ">注释</label><br><textarea name="HIS_NOTES_ST" id="HIS_NOTES_ST" COLS="35" ROWS="2" class="formElements" style='width:100%' maxlength=2000 onKeyUp="limitSize(this);" onKeyDown="limitSize(this);" onBlur="limitSize(this);"></textarea></td>
                </tr>
                <tr>
                    <td>
                        <button type="button" class="button noprint    first" id="domId_84064765" style="" onclick="performBulkAction('BULK_SET_GRAVITY',$(this));return false; ">执行</button>

                    </td>

                </tr>
            </table>
        </div>

        <div id="changeImpactAll" style="display:none;" class="bulkData">
            <h1>
                变化的影响
            </h1>
            <table width="100%">
                <tr>
                    <td>
                        <label for="ISSUE_IMPACT_ALL_txt" class=" ">问题的影响</label><br><input type=text name="ISSUE_IMPACT_ALL_txt" id="ISSUE_IMPACT_ALL_txt" size=10 class="formElements smartCombo" autocomplete='off' maxlength=255 autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,false );" onKeyDown="manageKeyEvent ($(this),event,false,false);" onKeyPress="stopKeyEvent(event);" value=""><span class="teamworkIcon menuArrow" style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="ISSUE_IMPACT_ALL" id="ISSUE_IMPACT_ALL" size=10 class="formElements" autocomplete='off' maxlength=255 jspPart='partSmartCombo' value="">

                    </td>
                </tr>
                <tr>
                    <td>
                        <button type="button" class="button noprint    first" id="domId_547705320" style="" onclick="performBulkAction('BULK_SET_IMPACT',$(this));return false; ">执行</button>

                    </td>

                </tr>
            </table>
        </div>


        <div id="changeDateAll" style="display:none;" class="bulkData">
            <h1>
                更改日期
            </h1>
            <table width="100%">
                <tr>
                    <td>
                        <label for="ISSUE_NEWDATE_ALL" class=" ">新日期</label><br><input type=text name="ISSUE_NEWDATE_ALL" id="ISSUE_NEWDATE_ALL" size=8 class="formElements dateField validated date" autocomplete='off' maxlength=255 onchange="$(this).oneTime(100,'dfblur',function(){if ($(this).is('.formElementsError')) {$(this).focus();} });" format="yyyy-M-d" value="" entryType="DATE" maxValue="3020-11-19" minValue="1020-10-29"><span title="日历" id="ISSUE_NEWDATE_ALLs_inputDate" class="teamworkIcon openCalendar"
                                                                                                                                                                                                                                                                                                                                                                                                                                                     onclick="var inp=$(this).prevAll(':input:first');$(this).dateField({inputField:inp,dateFormat:inp.attr('format'),isSearchField:false,minDate:inp.attr('minValue'),maxDate:inp.attr('maxValue'),disableHolidays:true});">m</span>


                    </td>
                </tr>
                <tr>
                    <td>
                        <button type="button" class="button noprint    first" id="domId_1689068422" style="" onclick="performBulkAction('BULK_SET_NEW_DATE',$(this));return false; ">执行</button>

                    </td>

                </tr>
            </table>
        </div>

        <div id="addCommentAll" style="display:none;" class="bulkData">
            <h1>
                评论
            </h1>
            <table width="100%">
                <tr>
                    <td valign='top'><textarea name="HIS_NOTES_ST" id="HIS_NOTES_ST" COLS="50" ROWS="4" class="formElements autosize" placeHolder='新增评论' style='width:100%' maxHeight=400 minHeight=125 lineHeight=15 maxlength=2000 onKeyUp="limitSize(this);" onKeyDown="limitSize(this);" onBlur="limitSize(this);"></textarea></td>
                </tr>
                <tr>
                    <td>
                        <button type="button" class="button noprint    first" id="domId_541913450" style="" onclick="performBulkAction('BULK_ADD_COMMENT',$(this));return false; ">执行</button>

                    </td>

                </tr>
            </table>
        </div>

        <div id="addTagsAll" style="display:none;" class="bulkData">
            <h1>
                创建标签
            </h1>
            <table width="100%">
                <tr>
                    <td valign='top'><br><input type=text name="ISSUE_TAGS" id="ISSUE_TAGS" size=20 class="formElements tagBox" title="标签应当用逗号分隔,如web,design" autocomplete='off' maxlength=255 style='width:100%;' autocomplete='off' taggableClass="com.twproject.task.Issue" maxResult="30" tagPropertyName="tags" areaId="5819" value=""></td>
                </tr>
                <tr>
                    <td>
                        <input type=hidden name="REPLACE_EXISTING" id="REPLACE_EXISTING" size=1 autocomplete='off' maxlength=255 data-checkfield value="no" oldValue='1'><input type="checkbox" id="ck_REPLACE_EXISTING" name="ck_REPLACE_EXISTING" value="yes"
                                                                                                                                                                                onClick="$(this).prevAll('[type=hidden]:first').val(this.checked ? 'yes' : 'no');">
                        &nbsp;<label for="ck_REPLACE_EXISTING">替换</label>&nbsp;
                    </td>
                </tr>
                <tr>
                    <td>
                        <button type="button" class="button noprint    first" id="domId_716382375" style="" onclick="performBulkAction('BULK_ADD_TAGS',$(this));return false; ">执行</button>

                    </td>

                </tr>
            </table>
        </div>




        <div style="display: none;" id="issueTemplates">
            <div class="__template__" type="ISSHISTPL">
                <!--
                  <tr histId="(#=obj.id#)" class="alternate">
                    <td valign="top" nowrap width="40">
                      <img class="face small" src="(#=obj.ownerAvatarUrl#)"  resid="(#=obj.ownerResourceId#)">
                    </td>
                    <td valign="top">
                      <div class="commentHeader"><b>(#!obj.lastModifier#)</b> - (#=dateToRelative(new Date(obj.creationDate))#)</div>
                      (#=obj.oldStatusName?"问题状态: "+obj.statusName+"<br>":""#)
                      (#!obj.assigneeName?"分工给: "+obj.assigneeName+"<br>":""#)
                      (#!obj.taskName?"任务: "+obj.taskName+"<br>":""#)
                      (#!obj.comment#)
                    </td>
                    <td valign="top" align="right" class="issHistDelBtn"><button type="button" class="button noprint textual icon  "  id="domId_1445251543" style=""   onclick="$(this).confirm(function(){deleteNotes($(this))});return false; " ><span class='teamworkIcon '>d</span></button>

                </td>
                  </tr>
                  -->
            </div>

        </div>

        <div style="display: none;" id="iltmplt">
            <div class="__template__" type="FILEBOX">
                <!--
                <div class="repoFileBox"  pf="(#=obj.id#)" title="预习 F#(#!obj.id#)#">
                  <span class="button textual">(#!obj.name#)</span><span class="del teamworkIcon" title="删除">d</span>
                </div>
                -->
            </div>
        </div>





        <script>
            var sortEnabled = false;
            var sortFlavour = "";
            var _showEmptyRow = false;

            //WARINING template must be loaded before rows
            $("#iltmplt").loadTemplates().remove();
            $.JST.loadDecorator("FILEBOX", function (box, pf) {
                box.data("pf", pf);
                //bind open image/download file
                box.click(function (ev) {
                    ev.stopPropagation();
                    openPersistentFile($(this).data("pf"));
                });

                //delete file
                box.find(".del").click(function (ev) {
                    ev.stopPropagation();
                    var el = $(this);
                    var fb = el.closest(".repoFileBox");
                    var editor = fb.closest("[issueID]");
                    fb.confirm(function () {
                        var box = $(this);
                        showSavingMessage();
                        var request = { CM: "DELSCRSHT", issueId: editor.attr("issueId"), fileUID: box.data("pf").uid, ck: box.data("pf").ck };
                        $.getJSON(contextPath + "/issue/issueAjaxControllerJson", request, function (response) {
                            jsonResponseHandling(response);
                            if (response.ok) {
                                var filesBox = box.closest(".filesBox");
                                if (filesBox.find(".repoFileBox").size() <= 1)
                                    filesBox.find(".filesIcon").hide();
                                box.fadeOut(200, function () { $(this).remove() });
                            }
                            hideSavingMessage();
                        });
                    }, "确认删除?");

                });
            });

            $(function () {

                //an issue_id has been passed as CE?
                if (false)
                    openIssueEditorInBlack(0);

                //issue update events from black popup editor
                registerEvent("issueEvent", function (e, data) {
                    //console.debug("issueEvent",data)
                    if (data.type == "delete")
                        $("[issueId=" + data.response.deletedId + "].issueRow").remove();
                    else if (data.type == "save") {

                        refreshIssueRow(data.response.issue.id, 400, false, function () {

                            if (data.response.askForNotes) {
                                showNotesForStatusChange(data.response.askForNotes);
                            }

                            if (data.response.askForWorklog) {
                                btnShowWorklog($("tr[issueid=" + data.response.issue.id + "]").find("[name=ISSUE_STATUS]").parent(".cvcComponent"));
                            }

                        });
                    }
                });

                //bind duplicate issue
                $("body").on("keydown", function (event) {
                    switch (event.keyCode) {
                        case 68: //left arrow
                            if (event.ctrlKey || event.metaKey) {
                                event.preventDefault();
                                duplicateCurrentIssue();
                            }
                    }
                });

                //bind for worklog Saved event
                registerEvent("worklogEvent.partIssueList", function (ev, data) {
                    //console.debug("worklog Saved",ev,data);
                    if (data.type == "save" && !$(".issueRow.inEdit[issueId=" + data.response.worklog.issueId + "]").find(":input[oldValue]").isValueChanged()) { // se ci sono dati cambiati non si rinfresca
                        refreshIssueRow(data.response.worklog.issueId, 100, true);
                    }
                });

                //inject the table search
                createTableFilterElement($("#headIssDescr"), ".dataTable [issueId]", ".issueDescTd,.issueTaskCell");

            });

            function dataTableCallback(num) {
                //console.debug("dataTableCallback", num);
                if ($("#FLT_ISSUE_ASSIGNED_TO").val()) {
                    sortEnabled = true;
                    sortFlavour = "BY_RESOURCE";
                } else if ($("#FLT_ISSUE_TASK").val()) {
                    sortEnabled = true;
                    sortFlavour = "BY_TASK";
                }

                var multi = $("#ISSUEFILTER .dataTableBody");

                multi.find("[issueId]").each(function () {
                    activateView($(this));
                });

                if (sortEnabled) {
                    var sortableHelper = function (e, ui) {
                        if (ui.is(".inEdit"))
                            return;

                        ui.children().each(function () {
                            $(this).width($(this).width());
                        });
                        var clone = ui.clone();
                        clone.css({ position: "absolute", marginLeft: 35 });
                        return clone;
                    };

                    multi.sortable({
                        sort: function (ev, ui) {
                            var sortedEl = $(ui.item);
                            if (sortedEl.is(".inEdit")) {
                                multi.sortable("cancel");
                                return;
                            }
                        },
                        handle: ".dragHandler",
                        axis: "y",
                        helper: sortableHelper,
                        opacity: 0.9,
                        update: function (ev, ui) {
                            var sortedEl = ui;
                            var issueRow = sortedEl.item;

                            //if (ev.ctrlKey) { // se droppo con ctrl copia la riga
                            //  multi.sortable("cancel");
                            //} else {
                            updateOrderAndGravity(issueRow);
                            //}
                        },
                        start: function (e, ui) {
                            ui.placeholder.height(ui.helper.outerHeight());
                            var sortedEl = $(ui.item);
                            if (sortedEl.is(".inEdit")) {
                                multi.sortable("cancel");
                                return;
                            }
                        },
                        end: function () { }
                    }).unselectable();
                }

                if (_showEmptyRow) {
                    addIssue();
                    _showEmptyRow = false;
                }
            }

            function moveIssueToTop(el) {
                //console.debug("moveIssueToTop",issueRow);
                var issueRow = el.closest("[issueid]");
                issueRow.fadeOut(300, function () {
                    $("#ISSUEFILTER .dataTableBody").prepend($(this));
                    updateOrderAndGravity($(this));
                    $(this).show();
                })
            }

            function moveIssueToBottom(el) {
                var issueRow = el.closest("[issueid]");
                issueRow.fadeOut(300, function () {
                    $("#ISSUEFILTER .dataTableBody").append($(this));
                    updateOrderAndGravity($(this));
                    $(this).show();
                })
            }

            function updateOrderAndGravity(issueRow) {
                var multi = $("#ISSUEFILTER .dataTableBody");
                //var sortedEl=ui;
                //var issueRow = sortedEl.item;

                //compute new gravity
                var prevIssue = issueRow.prev();
                var nextIssue = issueRow.next();
                var oldG = issueRow.attr("gravity");
                var newG = oldG;

                var prevG = prevIssue.attr("gravity");
                var nextG = nextIssue.attr("gravity");

                //move to bottom
                if (nextG == undefined) {
                    newG = prevG > oldG ? oldG : prevG;

                    //move to top
                } else if (prevG == undefined) {
                    newG = nextG < oldG ? oldG : nextG;

                    //move in the middle
                } else {
                    //not compatible place
                    if (!(nextG < oldG && prevG > oldG)) {
                        newG = nextG;
                    }
                    // else do nothing
                }

                //change gravity graphically
                issueRow.attr("gravity", newG);

                //update position only for strips with newG gravity. Order is always by gravity,position
                var sortedIds = [];
                multi.children().filter("[gravity=" + newG + "]").each(function (i) {
                    var row = $(this);
                    var issueId = row.attr("issueId");
                    sortedIds.push(issueId);
                    //if new issue set pending order
                    if (issueId.indexOf("new_") >= 0)
                        row.data("TEMP_ORDER", i);
                });

                var request = { CM: "SORT_ISSUES", SORT_FLAVOUR: sortFlavour, issues: sortedIds.join(",") };
                //if gravity changed send new gravity mand issue id
                if (oldG != newG) {
                    request["issueId"] = issueRow.attr("issueId");
                    request["newGravity"] = newG;
                }

                showSavingMessage();
                $.getJSON(contextPath + "/issue/issueAjaxControllerJson", request, function (response) {
                    jsonResponseHandling(response);
                    if (response.ok) {
                        //do nothing
                    }
                    hideSavingMessage();
                });
            }

            function editIssue(el) {
                //console.debug("editIssue",el) ;

                if (!hideWorklogEditorIfYouCan())
                    return;

                var issueRow = $(el).closest("[issueId]");
                var issueId = issueRow.attr("issueId");

                if (issueRow[0].isInEdit)
                    return;

                issueRow[0].isInEdit = true;

                var request = { CM: "EDIT", EDIT: sortEnabled ? "yes" : "no", ISSUEID: issueId };
                console.log(1);
                $.post(contextPath + "/issue/issueAjax", request, function (response) {
                    issueRow[0].isInEdit = false;
                    var editor = $(response);
                    var wst = $(window).scrollTop();
                    var issuePH = $("<div/>").css("height", 800);
                    activateEditor(editor);
                    editor.click();
                    $("body").append(issuePH);

                    issueRow.replaceWith(editor);

                    setTimeout(function () {
                        issuePH.remove();
                        //      $(window).scrollTop(wst)
                    }, 300);

                    //give focus to selected field
                    var fieldToFocus;
                    if (el.size() > 0)
                        fieldToFocus = $(el).attr("fieldName");

                    var inp = editor.find("[name=" + fieldToFocus + "]");
                    if ("ISSUE_GRAVITY" == fieldToFocus) {
                        inp.next().click();
                    } else {
                        if (inp.size() <= 0)
                            inp = editor.find("[name=ISSUE_DESCRIPTION]");
                        inp.focus();
                    }
                });
            }

            function refreshIssueRow(issueId, delay, flash, callback) {
                //console.debug("refreshIssueRow ",issueId, delay, flash);
                if (!delay)
                    delay = 1;

                $("body").oneTime(delay, "refreshIssueRow", function () {
                    var issueRow = $(".issueRow[issueId=" + issueId + "]");
                    var request = { CM: "REFRESHROW", DRAGENABLED: sortEnabled ? "yes" : "no", ISSUEID: issueId };
                    console.log(2);
                    $.get(contextPath + "/issue/issueAjax", request, function (response) {
                        var view = $(response);
                        activateView(view);
                        issueRow.replaceWith(view);

                        if (flash)
                            view.effect("highlight", { color: "#F9EFC5" }, 1500);

                        if (typeof (callback) == 'function')
                            callback();
                    });

                });
            }

            function activateView(view) {
                //console.debug("activateView",view, view.find("[fieldName]").length);

                view.initFields();

                view.find(".twLink").activateTeamworkLinks(true).emoticonize();

                view.find("[fieldName]").click(function (ev) {
                    ev.stopPropagation();
                    var el = $(this);
                    editIssue(el);
                    return false;
                });

                view.click(function () {
                    $(".issueRowFocused").removeClass("issueRowFocused");
                    $(this).addClass("issueRowFocused");
                });
                enableUpload(view);
            }

            //bind and decorate editor
            function activateEditor(editor) {
                editor.initFields();


                editor.find(":input[oldvalue]").on("keyup blur change", function () {
                    //console.debug("keyup blur change")
                    if ($(this).isValueChanged()) {
                        $("#issueButtonBar").show();
                        $(window).resize();
                        editor.find(".btnSave").removeClass("disabled");
                    }
                });

                //enlarge textarea
                editor.find("textarea.autosize").keydown(function (ev) {

                    //add key events to save the issue with the cmd or ctrl and or s keys
                    if (ev.ctrlKey || ev.metaKey)
                        switch (ev.keyCode) {

                            case 13: //return
                            case 83: //s
                                saveIssue($(this));
                                ev.preventDefault();
                                return false;
                                break;

                            default:
                                break;
                        };

                    //add key events to close the issue editor with the ESC key
                    if (ev.keyCode == 27) {
                        closeEditor($(this));
                        ev.preventDefault();
                        return false;
                    }


                });

                editor.click(function () {
                    $(".issueRowFocused").removeClass("issueRowFocused");
                    $(this).addClass("issueRowFocused");
                });

                enableUpload(editor);

            }

            function enableUpload(view) {
                view.find(".uploadizeDrop").each(function () {
                    $(this).uploadize({
                        url: contextPath + "/issue/issueAjaxControllerJson",
                        maxSize: 20971520,
                        activeElement: $(this).closest(".issueRow").get(0),
                        multi: true,
                        useSingleCall: true, // deve essere usata una sola chiamata altrimenti con N chiamata in sequenza vince solo l'ultima
                        showPlaceHolder: false,
                        additionalRequestParameters: { CM: "DROPDOC", issueId: view.attr("issueId") },
                        onLoadCallback: function (response) {
                            //console.debug("uploadize.onLoadCallback")
                            $(this).hide();

                            if (!response.files)
                                return;

                            for (var i = 0; i < response.files.length; i++) {
                                var file = response.files[i];
                                //console.debug("file uploaded ",file);

                                view.find(".filesBox").append($.JST.createFromTemplate(file, "FILEBOX"));
                                view.find(".filesIcon").show();

                                //in caso di nuova issue mette da una parte i pf temporanei
                                if (view.attr("issueId").indexOf("new_") >= 0) {
                                    //var tempPF = $("#PENDING_PF").val();
                                    var pfs = view.data("PENDING_PF") ? view.data("PENDING_PF") : [];
                                    pfs.push(file.uid);
                                    view.data("PENDING_PF", pfs);
                                }

                                //se c'Ã¨ un elemento con il focus ed Ã¨ la descrizione ci mette un placeholder
                                $(":focus#ISSUE_DESCRIPTION").each(function () {
                                    var ta = $(this);
                                    var pos = ta.get(0).selectionEnd;
                                    var text = ta.val();
                                    pos = pos || text.length;
                                    ta.val(text.substr(0, pos) + " F#" + file.id + "# " + (pos > 0 ? text.substr(pos) : ""));
                                })
                            }

                        },
                        resolvePasteElement: function (event) {
                            //console.debug("uploadize.resolvePasteElement")
                            var el = $(":focus").closest("[issueId]").find(".isUploadizer");
                            return el;
                        }

                    });
                }
                );
                view.bind("drop", function () {
                    $(this).find(".uploadizeDrop").show();
                    $(this).find(".uploadLabel").hide();
                });
            }

            function closeEditor(el) {
                closeEditorIfYouCan(el.closest(".inEdit"));
            }

            function closeEditorIfYouCan(editor) {
                var issueId = editor.attr("issueId");
                var ret = true;
                if (editor.size() > 0) {
                    if (editor.find(":input[oldValue]").isValueChanged()) {
                        if (confirm("你将失去你的变化！继续吗？")) {
                            if (editor.attr("issueId").startsWith("new"))
                                editor.remove();
                            else
                                refreshIssueRow(editor.attr("issueId"));
                        } else {
                            ret = false;
                        }
                    } else {
                        if (issueId.startsWith("new"))
                            editor.remove();
                        else
                            refreshIssueRow(issueId);
                    }
                }
                return ret;
            }

            function saveIssue(button) {
                if (!button.is(".disabled"))
                    saveRows(button.closest("tr.issueRow.inEdit"))
            }

            function saveAllIssues(button) {
                saveRows($("tr.issueRow.inEdit"))
            }

            function saveRows(jQueryRows) {

                var request = { CM: "SVISS" };
                var issues = [];
                jQueryRows.each(function () {
                    var editor = $(this);
                    //console.debug(editor)
                    if (editor.find(":input").isValueChanged()) {

                        if (canSubmitForm(editor)) {

                            var issueId = editor.attr("issueId");
                            var issue = { OBJID: issueId };
                            // extract every input in tr
                            editor.fillJsonWithInputValues(issue);

                            //controllo se ci solo dei PF pending
                            if (editor.data("PENDING_PF"))
                                issue["PENDING_PF"] = JSON.stringify(editor.data("PENDING_PF"));

                            //controllo se c'Ã¨ un sort pending
                            if (editor.data("TEMP_ORDER"))
                                issue["TEMP_ORDER"] = editor.data("TEMP_ORDER");
                            issue["SORT_FLAVOUR"] = sortFlavour;

                            issues.push(issue);
                        }
                    }
                });

                if (issues.length) {
                    showSavingMessage();

                    request.issues = JSON.stringify(issues);

                    $.post(contextPath + "/issue/issueAjaxControllerJson", request, function (response) {
                        jsonResponseHandling(response);
                        if (response.ok) {
                            $(".notesEditor").fadeOut();
                            if (response.oldIdNewId) {
                                for (var oldId in response.oldIdNewId) {
                                    var newId = response.oldIdNewId[oldId];
                                    //update issueId in case of new to make refreshIssueRow effective
                                    $("tr.issueRow[issueId=" + oldId + "]").attr("issueId", newId);
                                    refreshIssueRow(newId, 0, true);
                                }
                            }
                            if (response.rowErrors) {
                                var errMessages = [];
                                for (var oldId in response.rowErrors) {
                                    var issueRow = $("tr.issueRow[issueId=" + oldId + "]");
                                    jsonResponseHandling({ errors: response.rowErrors[oldId] }, issueRow);
                                    if (errMessages.indexOf(response.rowErrors[oldId][0].error) < 0)
                                        errMessages.push(response.rowErrors[oldId][0].error);
                                }
                                showFeedbackMessage("ERROR", errMessages.join("<br>"), "错误保存")
                            }
                        }
                        hideSavingMessage();
                        $("#issueButtonBar").hide();
                        $.buttonBar.manageButtonBar();
                    }, "json");
                }
            }

            function changeGravity() {
                var el = $(this);
                el.closest("tr").attr("gravity", el.val());
            }

            function changeStatus() {
                //console.debug("changeStatus")
                var el = $(this);
                var issueRow = el.closest("[issueId]");
                var issueId = issueRow.attr("issueId");
                if (el.isValueChanged() && !issueId.startsWith("new")) { // if new issue do not save immediately
                    showSavingMessage();

                    var request = { CM: "CHISSSTS", OBJID: issueId };
                    request[el.prop("name")] = el.val();
                    $.getJSON(contextPath + "/issue/issueAjaxControllerJson", request, function (response) {
                        jsonResponseHandling(response);
                        if (response.ok) {
                            el.updateOldValue();
                            // eventually shows wl insertion
                            if (response.assId) {
                                var issueText = "已关闭问题:" + (issueRow.find("[name=ISSUE_DESCRIPTION],[fieldname=ISSUE_DESCRIPTION]").text());
                                issueText = issueText.substr(0, Math.min(255, issueText.length));
                                btnShowWorklog(el.parent());
                            } else {
                                hideWorklogEditorIfYouCan();
                            }
                            //eventually show notes
                            if (response.histId) {
                                showNotesForStatusChange(response.histId);
                            } else {
                                $(".notesEditor").fadeOut();
                            }
                        } else {
                            el.val(el.getOldValue());
                            cvc_redraw(el.closest(".cvcComponent"));
                        }
                        hideSavingMessage();
                    });
                }
            }

            function addIssue() {
                $('.paginatorNotFound').hide();
                showSavingMessage();
                var request = { CM: "ADD", DRAGENABLED: sortEnabled ? "yes" : "no", ISSUE_TASK: "", ASSIGNEE: "15089" };
                console.log(3);
                $.post(contextPath + "/issue/issueAjax", request, function (response) {
                    var editor = $(response);
                    activateEditor(editor);

                    $("#ISSUEFILTER .dataTableHead").show();
                    $("#ISSUEFILTER .dataTableBody").prepend(editor);
                    editor.find("textarea").focus();

                    $(".issueRowFocused").removeClass("issueRowFocused");
                    editor.addClass("issueRowFocused");

                    hideSavingMessage();
                });
            }

            function delRow(el) {
                var issueRow = $(el).closest("[issueId]");
                var issueId = issueRow.attr("issueId");
                var isNew = issueId.startsWith("new");
                var taEmpty = issueRow.find("#ISSUE_DESCRIPTION").val() == '';
                if (isNew) {
                    if (taEmpty) {
                        issueRow.fadeOut(500, function () { $(this).remove(); });
                    } else {
                        el.confirm(function () { issueRow.fadeOut(500, function () { $(this).remove(); }); }, "确认删除?")
                    }
                } else {
                    deletePreview("ISS_DEL", issueId, function (response) {  // callback function
                        if (response && response.ok) {
                            issueRow.fadeOut(500, function () { $(this).remove(); });
                        }
                    });
                }
            }

            function duplicateCurrentIssue() {
                var issueRow = $(".issueRowFocused");
                if (issueRow.length > 0) {
                    clone(issueRow.find("td:first"), true);
                }
            }

            function clone(el, full) {
                var issueRow = $(el).closest("[issueId]");
                var issueId = issueRow.attr("issueId");

                if (issueRow.is(".inEdit")) { // if in edit duplicate the html
                    var editor = issueRow.clone();
                    editor.attr("issueId", "new_" + new Date().getTime());
                    editor.find(".filesBox").empty();
                    if (full) {
                        editor.find("[name=ISSUE_DESCRIPTION]").val(issueRow.find("[name=ISSUE_DESCRIPTION]").val());
                    }
                    activateEditor(editor);
                    issueRow.after(editor);
                    editor.find("textarea").focus();
                    editor.click();
                } else {

                    showSavingMessage();
                    var request = { CM: "CLONE", DRAGENABLED: sortEnabled ? "yes" : "no", ISSUEID: issueId, FULL: full ? "yes" : "no" };
                    console.log(4);
                    $.post(contextPath + "/issue/issueAjax", request, function (response) {
                        var editor = $(response);
                        activateEditor(editor);
                        issueRow.after(editor);
                        editor.find("textarea").focus();
                        hideSavingMessage();
                    });
                }
            }

            function showNotesForStatusChange(histId) { //questo viene visualizzato al top della pagina
                $("#floatWindow").append($("#insertStatusNotes"));
                $("#insertStatusNotes").attr("histId", histId).fadeIn();
            }

            function saveStatusNotes(el) {
                var theDiv = el.closest(".notesEditor");
                var histId = theDiv.attr("histId");
                showSavingMessage();
                var request = { CM: "SVHISTNOTES", histId: histId, notes: theDiv.find("textarea").val() };
                $.getJSON(contextPath + "/issue/issueAjaxControllerJson", request, function (response) {
                    jsonResponseHandling(response);
                    if (response.ok) {
                        theDiv.fadeOut();
                        theDiv.find("textarea").updateOldValue();
                        if (response.history) {
                            var row = $.JST.createFromTemplate(response.history, "ISSHISTPL");
                            $("#issHistTable").append(row);
                            row.effect("highlight", { color: "#F9EFC5" }, 1500);
                        }
                    }
                    hideSavingMessage();
                });
            }

            function btnShowWorklog(el) {
                var issueRow = el.closest("[issueId]");
                var issueText;
                if (issueRow.is(".inEdit"))
                    issueText = issueRow.find("[name=ISSUE_DESCRIPTION]").val();
                else
                    issueText = issueRow.find(".issueDesc").text();

                openWorklogEditorCloseToElement(el, { assId: issueRow.attr("assId"), text: issueText, issueId: issueRow.attr("issueId"), title: "问题: I#" + issueRow.attr("issueId") + "#" });
            }

            function reloadAssignee(el) {
                //console.debug("reloadAssignee",el);
                var editor = el.closest("[issueId]");
                var issueId = editor.attr("issueId");
                var taskField = editor.find("#ISSUE_TASK");
                if (taskField.isValueChanged()) {
                    var taskId = taskField.val();
                    var resName = editor.find("[name=ASSIGNEE_txt]").val();
                    var resId = editor.find("[name=ASSIGNEE]").val();
                    var request = { CM: "TASKCHANGED", TASKID: taskId, ISSUEID: issueId };
                    showSavingMessage();

                    $.getJSON(contextPath + "/issue/issueAjaxControllerJson", request, function (response) {
                        jsonResponseHandling(response);
                        if (response.ok && response.task) {
                            //si mettono i nuovi limiti sulle date
                            editor.find("#ISSUE_DATE_CLOSE_BY").attr("minvalue", response.task.startDate).attr("maxvalue", response.task.endDate);

                            // si cambia lo status combo
                            var cvcStatus = editor.find(".cvcStatus");
                            cvcStatus.attr("cvctype", "STATUSLINE" + response.task.areaId);
                            cvc_selectFirstElement(cvcStatus);

                        }
                        hideSavingMessage();
                    });
                }
            }


            function createNewAssegnee(el) {
                var row = el.closest(".issueRow");
                var name = row.find("[name=ASSIGNEE_txt]").val();
                var url = contextPath + "/applications/teamwork/resource/resourceNew.jsp?CM=ADD&name=" + encodeURI(name);

                openBlackPopup(url, 700, 320, function (response) {
                    //fillare lo smart combo
                    if (response && response.resId && response.resName) {
                        row.find("[name=ASSIGNEE]").val(response.resId);
                        row.find("[name=ASSIGNEE_txt]").val(response.resName).focus().blur();

                        //se Ã¨ stata creato un login si comunicano i dati
                        if (response.loginCreatedMessage)
                            showFeedbackMessage("INFO", response.loginCreatedMessage);

                    }
                })
            }



            function getCheckedIds() {
                var ret = [];
                $("#ISSUEFILTER .selector:checked").each(function () {
                    ret.push($(this).closestAttr("issueId"));
                });
                return ret;
            }

            function injectSelectedIds() {
                var form = $("#issueMultiEditor");
                $("[name=issueIds]").remove();
                var ids = getCheckedIds();
                if (ids.length > 0) {
                    // inject hidden ids field on form
                    var hid = $("<input type='hidden' name='issueIds'>");
                    hid.val(ids.join(","));
                    form.append(hid);
                }
            }

            function performBulkAction(command, el) {
                //console.debug("performBulkAction",command);
                var ids = getCheckedIds();
                if (ids.length > 0) {
                    var request = { CM: command, issueIds: ids.join(",") };
                    if (el) {
                        var bulkDiv = el.closest(".bulkData");
                        bulkDiv.fillJsonWithInputValues(request);
                    }

                    showSavingMessage();
                    $.getJSON(contextPath + "/issue/issueAjaxControllerJson", request, function (response) {
                        jsonResponseHandling(response);
                        if (response.ok) {
                            closeBlackPopup(response);
                            dataTableRefresh("ISSUEFILTER");
                        }
                        hideSavingMessage();
                    });
                }
            }

            function addComment(el) {
                showComments(el, true);
            }

            function showComments(el, add) {
                var row = el.closest("[issueId]");
                var issueId = row.attr("issueId");
                openBlackPopup(contextPath + "/applications/teamwork/issue/issueComments.jsp?issueId=" + issueId + (add ? "&CM=ADD" : "") + "&_=" + (new Date().getTime()), 800, 600, function () {
                    refreshIssueRow(issueId, 20, true);
                });
            }

            function drawFiles(issueId, files) {
                //console.debug("drawFiles",issueId,files);
                var ndo = $("[issueId=" + issueId + "] .filesBox");
                if (files.length > 0) {
                    ndo.find(".filesIcon").show();
                }
                //var icon = files.length ? $("<span/>").html("n ").addClass("teamworkIcon") : "";
                //ndo.append(icon);
                for (var i = 0; i < files.length; i++) {
                    ndo.append($.JST.createFromTemplate(files[i], "FILEBOX"));
                }
            }

        </script>


        <div class="paginator unselectable" dataTableId="ISSUEFILTER">
            <span class="paginatorPages"></span>
            <div class="datatableInfo">
                <div class="paginatorSearching">搜索...</div>
                <div class="paginatorNotFound">没有找到结果。</div>
                <span class="paginatorFoundN"><span class="totalNumberOfElements"></span>&nbsp;个结果</span>
                <span class="paginatorFound1">1 &nbsp;我打。.</span>
                &nbsp;&nbsp;
                <div class="pagSize">
                    <span class="ruzzol teamworkIcon" style="cursor:pointer;" onclick="$(this).toggle();$(this).next().toggle().find(':input').focus();" title="改变页面大小">g</span>
                    <span class="pagSizeInp">
                        <label for="_FP_PG_S" class=" ">每页的结果</label>&nbsp;<input type=text name="_FP_PG_S" id="_FP_PG_S" size=3 class="formElements formElementsSmall validated integer" autocomplete='off' maxlength=255 value="20" onkeyup="if (event.keyCode==13) { event.stopPropagation(); dataTableChangePageSize($('#ISSUEFILTER'));event.preventDefault();return false;}" entryType="INTEGER">
                    </span>
                </div>
            </div>

        </div>
        <div alertonchange=true>
            <input type=hidden name="_FP_PG_N" id="ISSUEFILTER_PGtf" size=20 class="formElements" autocomplete='off' maxlength=255 value="">
            <table class="table dataTable fixHead fixFoot" id="ISSUEFILTER" formId="issueMultiEditor" bindReturnKey data-table="1">
                <thead class="dataTableHead">
                    <tr>
                        <th class="tableHead" nowrap style=""><span class="tableHeadEl"><input type="checkbox" onclick="selUnselAll($(this));"></span></th>
                        <th class="tableHead" nowrap style=""><span class="tableHeadEl">级别</span></th>
                        <th class="tableHead" nowrap style=""><span class="tableHeadEl" orderState="0" orderingHql="issue.status" onclick="dataTableChangeOrder($(this),'ISSUEFILTER')">问题状态</span></th>
                        <th class="tableHead" id="headIssDescr" nowrap style=""><span class="tableHeadEl">描述</span></th>
                        <th class="tableHead" nowrap style=""><span class="tableHeadEl" orderState="0" orderingHql="task.name" onclick="dataTableChangeOrder($(this),'ISSUEFILTER')">任务</span></th>
                        <th class="tableHead" nowrap style=""><span class="tableHeadEl" orderState="0" orderingHql="resource.name" onclick="dataTableChangeOrder($(this),'ISSUEFILTER')">分工给</span></th>
                        <th class="tableHead" nowrap style=""><span class="tableHeadEl" orderState="0" orderingHql="issue.shouldCloseBy" onclick="dataTableChangeOrder($(this),'ISSUEFILTER')">做</span></th>
                        <th class="tableHead" nowrap style=""><span class="tableHeadEl">预估工期</span></th>
                        <th class="tableHead" nowrap style=""><span class="tableHeadEl"></span></th>
                    </tr>
                    <tr style="display: none;"><td colspan="99"><input type=hidden name="OB_ISSUEFILTER" id="OB_ISSUEFILTER" size=0 class="formElements" autocomplete='off' maxlength=255 value=""></td></tr>
                </thead>

                <tbody noData class="dataTableBody" totalNumberOfElements="0" pageNumber="0" pageSize="0"></tbody>

            </table>

        </div>
        <div class="paginator unselectable" dataTableId="ISSUEFILTER">
            <span class="paginatorPages"></span>
            <div class="datatableInfo">
            </div>
        </div>
        <div class="noprint buttonArea" id="issueButtonBar" style="text-align:left;">
            <div class="bbButtons">
                <button type="button" class="button noprint    first big" id="saveAllBtn" style="" onclick="saveAllIssues();return false; ">保存所有</button>
            </div>
        </div>
    </div>

</div>
