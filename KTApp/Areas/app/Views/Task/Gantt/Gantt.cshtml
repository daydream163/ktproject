
@{
    ViewBag.Title = "Gantt";
    Layout = "~/Areas/app/Views/Shared/_LayoutMain.cshtml";
}

<div id="__FEEDBACKMESSAGEPLACE" style="display:none;"></div>
<div id="twInnerContainer" class="null">
    <form enctype="application/x-www-form-urlencoded" method="POST"
          action="/app/task/gantt/gantt" name="d474471059" alertOnChange="true" id="d474471059"
          savedAction="" savedTarget="">
        <input type="hidden" id="d474471059V_ID" name="V_ID" value="474471059" savedValue="">
        <input type="hidden" id="d474471059CM" name="CM" value="" savedValue="">
        <input type="hidden" id="d474471059OBJID" name="OBJID" value="53595" savedValue="">

        <input type=hidden name="Gantt" id="Gantt" size=20 class="formElements" autocomplete='off' maxlength=255 value="" oldValue='1'>
    </form>
    <div class="mainColumn">


        <div class="pathToObject">
            <a class="button  textual   " id="domId_720387025" style="" href="/app/task/taskList?V_ID=279702135">任务列表 /</a>


            <div class="currentNode">
                <span class="teamworkIcon" style="color:#3BBF67;font-size:22px;" title="进行中">&copy;</span>

                <a class="button  textual   objectName" id="domId_112079662" style="" href="/app/task/taskOverview?V_ID=1793822468&CM=ED&OBJID=53595">第一个项目</a>

                <span class="menuArrow" onclick="bjs_showMenuDiv('divdomo_domId_1104187407', 'domId_1752985800');  ">
                    <button type="button" class="button noprint textual icon  " id="domId_1752985800" style="" onclick=";return false; "><span class='teamworkIcon '>&ugrave;</span></button>


                </span>

                <div id="divdomo_domId_1104187407" class="divomo "
                     style=" position: absolute;left:-10000px; top:-10000px;">

                    <div class="divomoArrow"></div>

                    <div>
                        <a class="button  textual   " id="domId_1671555722" style="" href="/app/task/gantt/gantt?V_ID=408975232&CM=ED&OBJID=53682">第一个子任务</a>

                        <a class="button  textual   " id="domId_455949600" style="" href="/app/task/gantt/gantt?V_ID=907565809&CM=ED&OBJID=53683">第二个子任务</a>

                        <a class="button  textual   " id="domId_923274704" style="" href="/app/task/gantt/gantt?V_ID=236702688&CM=ED&OBJID=53684">第三个子任务</a>

                        <a class="button  textual   " id="domId_1908600553" style="" href="/app/task/gantt/gantt?V_ID=58115156&CM=ED&OBJID=53685">第四个子任务</a>

                    </div>
                </div>
            </div>
        </div>




        <div class="pathCodeWrapper">

            <span class='pathCode' title='参考代码'>T#T53595#</span>
            &nbsp;
            <span class='pathCode'>
                开始日期 <b class="" title="">2020-11-9</b>&nbsp;&nbsp;&nbsp;
                结束日期 <b class="" title="">2020-11-30</b>&nbsp;&nbsp;&nbsp;
                (天: <b>16</b>)
            </span>

        </div>
        <script>
            $(function () {
                $("#TASK_MENU").addClass('selected');
            });
        </script>
        <style>
            .tabTaskColoured { position: relative; padding-left: 7px; }

                .tabTaskColoured:after { background-color: #bc4cff !important; position: absolute; width: 12px; left: 3px; content: ""; bottom: 3px; top: 3px; padding: 0; border-radius: 4px 0 0 0; }
        </style>

        <div class="tabSetBox" style="">
            <input type=hidden name="TASK_TABSET" id="TASK_TABSET" size=20 class="formElements" autocomplete='off' maxlength=255 value="TASK_GANTT_TAB">
            <div class="tabSetHeader noprint">
                <div class="tabSetPre"></div>
                <div class="tabSetTabs" id="TABSETTABS_TASK_TABSET">
                    <div id="TASK_GENERAL_TAB" tabset="TASK_TABSET" class=" tabTaskColoured tab" style="cursor:pointer;">
                        <a class="button  textual   " id="btn_taskGeneralData" style="" href="/app/task/taskOverview?V_ID=92180602&CM=ED&OBJID=53595">项目数据</a>


                    </div>

                    <div id="TASK_GANTT_TAB" tabset="TASK_TABSET" class="tabSelected tab" style="cursor:pointer;">
                        <a class="button  textual  focused lreq10 lreqLabel lreqActive" id="btnGantt" style="" href="/app/task/gantt/gantt?V_ID=1066838794&CM=GANTT&OBJID=53595">甘特图</a>


                    </div>

                    <div id="TASK_ASSIGNMENT_TAB" tabset="TASK_TABSET" class=" tab" style="cursor:pointer;">
                        <a class="button  textual   " id="domId_1984426998" style="" href="/app/task/taskAssignmentList?V_ID=575703801&CM=FN&TASK_ID=53595">责任人 (5)</a>


                    </div>

                    <div id="TASK_COST_TAB" tabset="TASK_TABSET" class=" tab" style="cursor:pointer;">
                        <a class="button  textual   " id="btnCosts" style="" href="/app/task/TaskCostList?V_ID=1308147261&OBJID=53595">费用</a>


                    </div>

                    <div id="TASK_ISSUES_TAB" tabset="TASK_TABSET" class=" tab" style="cursor:pointer;">
                        <a class="button  textual   " id="domId_913012196" style="" href="/app/task/taskIssueList?V_ID=595886330&OBJID=53595">问题  (4/4)</a>


                    </div>

                    <div id="TASK_DOCS_TAB" tabset="TASK_TABSET" class=" tab" style="cursor:pointer;">
                        <a class="button  textual   " id="domId_1586048396" style="" href="/app/task/taskDocumentList?V_ID=1788744027&CM=LIST_DOCS&TASK_ID=53595">文档 (4)</a>


                    </div>

                    <div id="TASK_TLOG_TAB" tabset="TASK_TABSET" class=" tab" style="cursor:pointer;">
                        <a class="button  textual   lreq10 lreqLabel lreqActive" id="domId_1928132445" style="" href="/app/task/taskForumList?V_ID=1859463219&TASK_ID=53595">讨论(2)</a>


                    </div>

                </div>
                <div class="tabSetPost"></div>
            </div>
            <div class="tabContainer clearfix" id="TABSETPART_TASK_TABSET">



            </div>
        </div>




        <link rel=stylesheet href="gantt.css?65022" type="text/css">
        <link rel=stylesheet href="ganttStatusColors.css?65022" type="text/css">

        <script type="text/javascript" src="/commons/js/jquery/svg/jquery.svg.min.js"></script>
        <script type="text/javascript" src="/commons/js/jquery/svg/jquery.svgdom.1.8.js"></script>


        <script type="text/javascript" src="ganttUtilities.js?65022"></script>
        <script type="text/javascript" src="ganttTask.js?65022"></script>
        <script type="text/javascript" src="ganttDrawerSVG.js?65022"></script>
        <script type="text/javascript" src="ganttZoom.js?65022"></script>
        <script type="text/javascript" src="ganttGridEditor.js?65022"></script>
        <script type="text/javascript" src="ganttMaster.js?65022"></script>
        <script type="text/javascript" src="ganttPDF.js?65022"></script>


        <script type="text/javascript" src="ganttProgressCheckBarSVG.js?65022"></script>




        <div class="lreq10 lreqPage">
            <div id="workSpace"></div>
        </div>

        <script type="text/javascript">

            var ge;
            $(function () {

                //initialize colorpicker components
                initialize(contextPath + "/commons/js/jquery/spectrum/spectrum.css", "css");
                initialize(contextPath + "/commons/js/jquery/spectrum/tw_spectrum.css", "css");
                initialize(contextPath + "/commons/js/jquery/spectrum/spectrum.js", "script");

                //slider
                initialize(contextPath + "/commons/js/jquery/valueSlider/mb.slider.css", "css");
                initialize(contextPath + "/commons/js/jquery/valueSlider/jquery.mb.slider.js", "script");

                //initialize jpdf components
                initialize(contextPath + "/commons/js/jsPDF/dist/jspdf.min.js", "script");
                initialize(contextPath + "/commons/js/jsPDF/libs/png_support/png.js", "script");
                initialize(contextPath + "/commons/js/jsPDF/libs/png_support/zlib.js", "script");


                //fix old collapsed task
                fixOldCollapsedTaskString();

                ge = new GanttMaster();
                ge.resourceUrl = contextPath + "/app/task/gantt/res/"; //"applications/teamwork/task/gantt/res/";
                ge.set100OnClose = false;

                ge.shrinkParent = false;

                ge.isSingleArea = false

                loadI18n(); //overwrite with localized ones

                ge.init($("#workSpace"));

                //in order to force compute the best-fitting zoom level
                delete ge.gantt.zoom;


                loadGanttFromServer("53595", function (response) {
                    $("body").oneTime(100, "clickrow", function () { // delayed as gant is refreshed after 50ms
                        ge.getTask("53595").rowElement.click();
                    });
                });



                if (true) {
                    initializeHistoryManagement("53595");
                }
            });

            function newProjectFromServer() {
                //console.debug("newProjectFromServer");
                var data = { CM: "NEWPROJECT" };
                $.getJSON("/task/ganttAjax", data, function (response) {
                    jsonResponseHandling(response);
                    if (response.ok) {
                        ge.loadProject(response.project);
                        ge.checkpoint(); //empty the undo stack

                        ge.editor.element.oneTime(100, "cl", function () { $(this).find("tr.emptyRow:first").click() });
                    }
                });
            }

            function loadGanttFromServer(taskId, callback) {
                //console.debug("loadGanttFromServer",taskId);
                var data = { CM: "LOADPROJECT", taskId: taskId };
                $.getJSON("/task/ganttAjax", data, function (response) {
                    jsonResponseHandling(response);
                    if (response.ok) {
                        ge.loadProject(response.project);
                        ge.checkpoint(); //empty the undo stack
                        if (typeof (callback) == "function")
                            callback(response);
                    }
                });

            }


            function saveGanttOnServer(el) {
                if (el.is(".disabled"))
                    return;

                el.addClass("disabled"); // per evitare doppi click che raddoppierebbero le righe
                var prj = ge.saveGantt();

                if (ge.deletedTaskIds.length > 0) {
                    if (!confirm("Tasks that will be removed:\n" + ge.deletedTaskIds.length))
                        return;
                }

                showSavingMessage();
                $.ajax("/task/ganttAjax", {
                    dataType: "json",
                    data: { CM: "SVPROJECT", prj: JSON.stringify(prj) },
                    type: "POST",

                    success: function (response) {
                        hideSavingMessage();
                        jsonResponseHandling(response);
                        if (response.ok) {
                            if (response.project) {
                                ge.loadProject(response.project); //must reload as "tmp_" ids are now the good ones
                                ge.checkpoint(); //empty the undo stack
                            } else {
                                ge.reset();
                            }
                        }
                    }
                });
            }


            function fixOldCollapsedTaskString() {
                if (localStorage && localStorage.getItem("TWPGanttCollTasks") && !localStorage.getItem("TWPGanttCollTasks").startsWith("[")) {
                    localStorage.setObject("TWPGanttCollTasks", []);
                }

            }


            var lastPeriodChecked;

            function getCurrentTaskPeriod() {
                //console.debug("getCurrentTaskPeriod",$(".ganttTaskEditor [name=start]")) ;
                var ret = { startMillis: Date.parseString($(".ganttTaskEditor [name=start]").val()).setHours(0, 0, 0), endMillis: Date.parseString($(".ganttTaskEditor [name=end]").val()).setHours(23, 59, 59) };
                return ret;
            }

            function updateResourceLoad(el) {
                //console.debug("updateResourceLoad")
                var row = el.closest("tr");
                computeResourceLoad(el, getCurrentTaskPeriod(), row.find("[name=resourceId]").val(), millisFromString(row.find("[name=effort]").val(), true), row.attr("assId"));
            }

            function workloadDatesChanged(forceReload) {
                //console.debug("workloadDatesChanged");
                var ret = getCurrentTaskPeriod();
                if (forceReload || (!lastPeriodChecked || ret.startMillis != lastPeriodChecked.startMillis || ret.endMillis != lastPeriodChecked.endMillis)) {
                    lastPeriodChecked = ret;
                    $("tr.assigEditRow [name=resourceId]").each(function () {
                        var inp = $(this);
                        if (parseInt(inp.val())) {
                            updateResourceLoad(inp);
                        }
                    })
                }
            }



            function initializeHistoryManagement(taskId) {

                //retrieve from server the list of history points
                $.getJSON(contextPath + "/task/taskAjax", { CM: "GETGANTTHISTPOINTS", OBJID: taskId }, function (response) {

                    //if there are history points
                    if (response.ok == true && response.historyPoints && response.historyPoints.length > 0) {

                        //add show slider button on button bar
                        var histBtn = $("<button>").addClass("button textual icon lreq30 lreqLabel actionButton histButton").attr("title", "SHOW_HISTORY").append("<span class=\"teamworkIcon\">&#x60;</span>");

                        //clicking it
                        histBtn.click(function () {
                            var el = $(this);
                            var ganttButtons = $(".ganttButtonBar .buttons");

                            //is it already on?
                            if (!ge.element.is(".historyOn")) {
                                ge.element.addClass("historyOn");
                                ganttButtons.find(".actionButton:not(.histButton)").hide();

                                //load the history points from server again
                                showSavingMessage();
                                $.getJSON(contextPath + "/task/taskAjax", { CM: "GETGANTTHISTPOINTS", OBJID: ge.tasks[0].id }, function (response) {
                                    jsonResponseHandling(response);
                                    hideSavingMessage();
                                    if (response.ok == true) {
                                        var dh = response.historyPoints;
                                        if (dh && dh.length > 0) {
                                            //si crea il div per lo slider
                                            var sliderDiv = $("<div>").prop("id", "slider").addClass("lreq30 lreqHide").css({ "display": "inline-block", "width": "500px" });
                                            ganttButtons.append(sliderDiv);

                                            var minVal = 0;
                                            var maxVal = dh.length - 1;

                                            $("#slider").show().mbSlider({
                                                rangeColor: '#2f97c6',
                                                minVal: minVal,
                                                maxVal: maxVal,
                                                startAt: maxVal,
                                                showVal: false,
                                                grid: 1,
                                                formatValue: function (val) {
                                                    return new Date(dh[val]).format();
                                                },
                                                onSlideLoad: function (obj) {
                                                    this.onStop(obj);

                                                },
                                                onStart: function (obj) { },
                                                onStop: function (obj) {
                                                    var val = $(obj).mbgetVal();
                                                    showSavingMessage();
                                                    //load the data history for that milliseconf from server
                                                    $.getJSON(contextPath + "/task/taskAjax", { CM: "GETGANTTHISTORYAT", OBJID: ge.tasks[0].id, millis: dh[val] }, function (response) {
                                                        jsonResponseHandling(response);
                                                        hideSavingMessage();
                                                        if (response.ok) {
                                                            ge.baselines = response.baselines;
                                                            ge.showBaselines = true;
                                                            ge.baselineMillis = dh[val];
                                                            ge.redraw();
                                                        }
                                                    })

                                                },
                                                onSlide: function (obj) {
                                                    clearTimeout(obj.renderHistory);
                                                    var self = this;
                                                    obj.renderHistory = setTimeout(function () {
                                                        self.onStop(obj);
                                                    }, 200)

                                                }
                                            });
                                        }
                                    }
                                });


                                // closing the history
                            } else {
                                //remove the slider
                                $("#slider").remove();
                                ge.element.removeClass("historyOn");
                                if (ge.permissions.canWrite)
                                    ganttButtons.find(".actionButton").show();

                                ge.showBaselines = false;
                                ge.baselineMillis = undefined;
                                ge.redraw();
                            }

                        });
                        $("#saveGanttButton").before(histBtn);
                    }
                })
            }

            function showBaselineInfo(event, element) {
                //alert(element.attr("data-label"));
                $(element).showBalloon(event, $(element).attr("data-label"));
                ge.splitter.secondBox.one("scroll", function () {
                    $(element).hideBalloon();
                })
            }



        </script>

        <script>


            function computeResourceLoad(el, period, resId, currentWorkload, assId) {
                //console.debug("computeResourceLoad",period, resId, currentWorkload,assId);

                if (!period || false)
                    return;

                var row = el.closest("tr");
                //si chiama con delay sulla riga in modo da
                row.stopTime("loadOpLoad");
                var workloadInfo = row.find(".workloadInfo");
                workloadInfo.removeClass("loading").empty();

                if (resId) {
                    workloadInfo.addClass("loading");
                    row.oneTime(1000, "loadOpLoad", function () {
                        getOperatorLoad(resId, period.startMillis, period.endMillis, currentWorkload, assId, function (response) {
                            if (response.ok && response.stats) {
                                var bl = $("<div>").attr({ "data-timer": 0, "data-forceposition": "left" });
                                bl.attr("data-balloon", "<b>工作量期</b><br><span class='textSmall'>" +
                                    (new Date().format()) + " : " + (new Date(period.endMillis).format()) + "<br>" +
                                    "工作量 - min: " + getMillisInHoursMinutes(response.stats.minLoad) + "  max: <b>" + getMillisInHoursMinutes(response.stats.maxLoad) + "</b><br>" +
                                    "平均工作能力: " + getMillisInHoursMinutes(response.stats.meanCapacity) + "<br>"
                                );
                                bl.css("cursor", "pointer");
                                bl.addClass("");
                                if (response.stats.meanLoadPerc > 100)
                                    bl.addClass("warning alertIcon");
                                else if (response.stats.meanLoadPerc > 90)
                                    bl.addClass("attention");
                                bl.append(parseInt(response.stats.meanLoadPerc) + "%");
                                workloadInfo.empty().append(bl);
                            } else {
                                workloadInfo.empty();
                            }
                            workloadInfo.removeClass("loading");
                        });
                    })
                }
            }



            function getOperatorLoad(resId, startMillis, endMillis, currentWL, assId, callback) {
                //console.debug("getOperatorLoad",resId, startMillis, endMillis, currentWL, assId);
                //se il progetto doveva giÃ  essere chiuso non si calcola niente
                if (endMillis < new Date().getTime()) {
                    if (typeof (callback) == "function") {
                        callback({ ok: false });
                    }
                    return;
                }

                var request = {
                    CM: "GETOPLOAD",
                    resId: resId,
                    startMillis: startMillis,
                    endMillis: endMillis,
                    simulatedLoad: currentWL,
                    assId: assId
                };
                $.getJSON(contextPath + "/applications/teamwork/task/plan/planAjaxController.jsp", request, function (response) {
                    jsonResponseHandling(response);
                    if (typeof (callback) == "function") {
                        callback(response);
                    }
                })
            }
        </script>



        <script type="text/javascript">

            (function () {
                var cvd = { values: [{ "code": "STATUS_ACTIVE", "color": "#3BBF67", "value": "进行中", "enabled": true, "textColor": "#FFFFFF", "index": 1 }, { "code": "STATUS_WAITING", "color": "#F79136", "value": "等候", "enabled": true, "textColor": "#FFFFFF", "index": 2 }, { "code": "STATUS_SUSPENDED", "color": "#F9C154", "value": "暂停", "enabled": true, "textColor": "#000000", "index": 3 }, { "code": "STATUS_DONE", "color": "#6EBEF4", "value": "完成", "enabled": true, "textColor": "#000000", "index": 4 }, { "code": "STATUS_FAILED", "color": "#763A96", "value": "失败", "enabled": true, "textColor": "#FFFFFF", "index": 5 }, { "code": "STATUS_UNDEFINED", "color": "#dededf", "value": "未定义", "enabled": true, "textColor": "#000000", "index": 6 }] };


                _colorValueData["STATUS"] = cvd;

            })();
        </script>


        <div id="gantEditorTemplates" style="display:none;">
            <div class="__template__" type="GANTBUTTONS">
                <!--
                <div class="ganttButtonBar noprint">
                  <div class="buttons">

                    <button onclick="$('#workSpace').trigger('undo.gantt');return false;" class="button textual icon actionButton" title="复原"><span class="teamworkIcon">&#39;</span></button>
                    <button onclick="$('#workSpace').trigger('redo.gantt');return false;" class="button textual icon actionButton" title="redo"><span class="teamworkIcon">&middot;</span></button>
                    <span class="ganttButtonSeparator actionButton"></span>
                    <button onclick="$('#workSpace').trigger('addAboveCurrentTask.gantt');return false;" class="button textual icon actionButton" title="上面填写"><span class="teamworkIcon">l</span></button>
                    <button onclick="$('#workSpace').trigger('addBelowCurrentTask.gantt');return false;" class="button textual icon actionButton" title="insert below"><span class="teamworkIcon">X</span></button>
                    <span class="ganttButtonSeparator actionButton"></span>
                    <button onclick="$('#workSpace').trigger('outdentCurrentTask.gantt');return false;" class="button textual icon actionButton" title="撤消"><span class="teamworkIcon">.</span></button>
                    <button onclick="$('#workSpace').trigger('indentCurrentTask.gantt');return false;" class="button textual icon actionButton" title="缩进任务"><span class="teamworkIcon">:</span></button>
                    <span class="ganttButtonSeparator actionButton"></span>
                    <button onclick="$('#workSpace').trigger('moveUpCurrentTask.gantt');return false;" class="button textual icon actionButton" title="move up"><span class="teamworkIcon">k</span></button>
                    <button onclick="$('#workSpace').trigger('moveDownCurrentTask.gantt');return false;" class="button textual icon actionButton" title="move down"><span class="teamworkIcon">j</span></button>

                    <span class="ganttButtonSeparator actionButton"></span>
                    <button onclick="$('#workSpace').trigger('deleteFocused.gantt');return false;" class="button textual icon delete actionButton" title="删除"><span class="teamworkIcon">&cent;</span></button>

                    <span class="ganttButtonSeparator actionButton"></span>
                    <button onclick="$('#workSpace').trigger('addIssue.gantt');return false;" class="button textual icon actionButton" title="创建问题"><span class="teamworkIcon">i</span></button>


                    <span class="ganttButtonSeparator"></span>
                    <button onclick="$('#workSpace').trigger('expandAll.gantt');return false;" class="button textual icon " title="展开全部"><span class="teamworkIcon">6</span></button>
                    <button onclick="$('#workSpace').trigger('collapseAll.gantt'); return false;" class="button textual icon " title="全部收缩"><span class="teamworkIcon">5</span></button>

                    <span class="ganttButtonSeparator"></span>
                    <button onclick="$('#workSpace').trigger('zoomMinus.gantt'); return false;" class="button textual icon " title="缩小"><span class="teamworkIcon">)</span></button>
                    <button onclick="$('#workSpace').trigger('zoomPlus.gantt');return false;" class="button textual icon " title="放大"><span class="teamworkIcon">(</span></button>
                    <span class="ganttButtonSeparator"></span>

                    <button onclick="$('#workSpace').trigger('print.gantt');return false;" class="button textual icon " title="打印"><span class="teamworkIcon">p</span></button>
                    <span class="ganttButtonSeparator"></span>

                    <button onclick="$('#workSpace').trigger('toggleCritical.gantt');return false;" id="critPathBtn" class="button textual icon" title="显示/隐藏关键路径"><span class="teamworkIcon">&pound;</span></button>
                    <span class="ganttButtonSeparator"></span>
                    <button onclick="ge.splitter.resize(.1);return false;" class="button textual icon" ><span class="teamworkIcon">F</span></button>
                    <button onclick="ge.splitter.resize(50);return false;" class="button textual icon" ><span class="teamworkIcon">O</span></button>
                    <button onclick="ge.splitter.resize(100);return false;" class="button textual icon"><span class="teamworkIcon">R</span></button>
                    <span class="ganttButtonSeparator"></span>
                    <button onclick="$('#workSpace').trigger('fullScreen.gantt');return false;" class="button textual icon" title="FULLSCREEN" id="fullscrbtn"><span class="teamworkIcon">@@</span></button>
                    <button onclick="ge.element.toggleClass('colorByStatus' );return false;" class="button textual icon"><span class="teamworkIcon">&sect;</span></button>


                      <button onclick="$('#workSpace').trigger('shrink.gantt');return false;" class="button textual icon " title="GANTT_SHRINK"><span class="teamworkIcon">&#11044;</span></button>


                    <div id="saveGanttButton" onclick="saveGanttOnServer($(this));return false;" class="button first disabled" title="保存">保存</div>
                  </div></div>
                -->
            </div>
            <div class="__template__" type="TASKSEDITHEAD">
                <!--
                <table class="gdfTable" cellspacing="0" cellpadding="0">
                  <thead>
                  <tr style="height:40px">
                    <th class="gdfColHeader" style="width:35px; border-right: none"></th>
                    <th class="gdfColHeader" style="width:25px;"></th>
                    <th class="gdfColHeader gdfResizable" style="width:100px;">代码</th>
                    <th class="gdfColHeader gdfResizable" style="width:300px;">名称</th>
                    <th class="gdfColHeader"  align="center" style="width:17px;" title="起始日期是一个重要的步骤。"><span class="teamworkIcon" style="font-size: 8px;">^</span></th>
                    <th class="gdfColHeader gdfResizable" style="width:80px;">开始日期</th>
                    <th class="gdfColHeader"  align="center" style="width:17px;" title="结束日期是一个重要的步骤。"><span class="teamworkIcon" style="font-size: 8px;">^</span></th>
                    <th class="gdfColHeader gdfResizable" style="width:80px;">结束日期</th>
                    <th class="gdfColHeader gdfResizable" style="width:50px;">连接时间</th>
                    <th class="gdfColHeader gdfResizable" style="width:20px;">%</th>
                    <th class="gdfColHeader gdfResizable requireCanSeeDep" style="width:50px;">取决于</th>
                    <th class="gdfColHeader gdfResizable taskAssigs" style="width:1000px; text-align: left; padding-left: 10px;">责任人</th>
                  </tr>
                  </thead>
                </table>
                -->
            </div>




            <div class="__template__" type="TASKROW">
                <!--
                  <tr id="tid_(#=obj.id#)" taskId="(#=obj.id#)" class="taskEditRow (#=obj.isParent()?'isParent':''#) (#=obj.collapsed?'collapsed':''#) (#=obj.id.startsWith('tmp_')?'newTask':''#)" level="(#=level#)">
                    <th class="gdfCell edit" align="right" style="cursor:pointer;"><span class="taskRowIndex">(#=obj.getRow()+1#)</span> <span class="teamworkIcon" style="font-size:100%;" >&#xFE19;</span></th>



                    <td class="gdfCell noClip" align="center">
                      <div class="cvcComponent" style="cursor:pointer;" cvctype="STATUS">
                        <input type="hidden" name="status" size="2" class="formElements" autocomplete="off" maxlength="255" oldvalue="1" value="(#=obj.status#)">
                        <div class="cvcColorSquare">
                          <div class="cvcStatuses">
                            <div class="cvcSelBox" title="(#=GanttMaster.taskStatusDecoder[obj.status].label#)" code="(#=obj.status#)"><span class="teamworkIcon" style="color:(#=GanttMaster.taskStatusDecoder[obj.status].color#)">©</span></div>
                          </div>
                        </div>
                      </div>

                    </td>


                    <td class="gdfCell"><input type="text" name="code" value="(#!obj.code?obj.code:''#)" placeholder="代码"></td>
                    <td class="gdfCell indentCell" style="padding-left:(#=obj.level*10+18#)px;">
                      <div class="exp-controller" align="center"></div>
                      <input type="text" name="name" value="(#!obj.name#)" placeholder="名称">
                    </td>
                    <td class="gdfCell" align="center"><input type="checkbox" name="startIsMilestone"></td>
                    <td class="gdfCell">
                <input type=text name="start" id="start" size=8 class="formElements dateField validated date" autocomplete='off' maxlength=255  onchange ="$(this).oneTime(100,'dfblur',function(){if ($(this).is('.formElementsError')) {$(this).focus();} });"  format="yyyy-M-d" value="" oldValue='1' entryType="DATE" maxValue="3020-11-20" minValue="1020-10-30" >
                </td>
                    <td class="gdfCell" align="center"><input type="checkbox" name="endIsMilestone"></td>
                    <td class="gdfCell">
                <input type=text name="end" id="end" size=8 class="formElements dateField validated date" autocomplete='off' maxlength=255  onchange ="$(this).oneTime(100,'dfblur',function(){if ($(this).is('.formElementsError')) {$(this).focus();} });"  format="yyyy-M-d" value="" oldValue='1' entryType="DATE" maxValue="3020-11-20" minValue="1020-10-30" >
                </td>
                    <td class="gdfCell"><input type="text" name="duration" autocomplete="off" value="(#=obj.duration#)"></td>
                    <td class="gdfCell"><input type="text" name="progress" class="validated" entrytype="PERCENTILE" autocomplete="off" value="(#=obj.progress?obj.progress:''#)" (#=obj.progressComputeType!=0?"readOnly":""#)></td>
                    <td class="gdfCell requireCanSeeDep"><input type="text" name="depends" autocomplete="off" value="(#=obj.depends#)" (#=obj.hasExternalDep?"readonly":""#)></td>
                    <td class="gdfCell taskAssigs">(#!obj.getAssigsString()#)</td>
                  </tr>
                  -->
            </div>

            <div class="__template__" type="TASKEMPTYROW">
                <!--
                <tr class="taskEditRow emptyRow" >
                  <th class="gdfCell" align="right"></th>
                  <td class="gdfCell noClip" align="center"></td>
                  <td class="gdfCell"></td>
                  <td class="gdfCell"></td>
                  <td class="gdfCell"></td>
                  <td class="gdfCell"></td>
                  <td class="gdfCell"></td>
                  <td class="gdfCell"></td>
                  <td class="gdfCell"></td>
                  <td class="gdfCell"></td>
                  <td class="gdfCell requireCanSeeDep"></td>
                  <td class="gdfCell"></td>
                </tr>
                -->
            </div>


            <div class="__template__" type="CHECKBAR_DATE_LABEL">
                <!--
                <div class="checkBarDateLabel" style="background-color: (#=color#)" label="(#=label#)">(#=label#)<span class="checkBarDateLabelRemove del teamworkIcon">x</span></div>
                -->
            </div>


            <div class="__template__" type="CHANGE_STATUS">
                <!--
                <div class="taskStatusBox">
                  <div class="taskStatus cvcColorSquare" status="STATUS_ACTIVE" title="进行中"></div>
                  <div class="taskStatus cvcColorSquare" status="STATUS_DONE" title="完成"></div>
                  <div class="taskStatus cvcColorSquare" status="STATUS_FAILED" title="失败"></div>
                  <div class="taskStatus cvcColorSquare" status="STATUS_SUSPENDED" title="暂停"></div>
                  <div class="taskStatus cvcColorSquare" status="STATUS_WAITING" title="等候" style="display: none;"></div>
                  <div class="taskStatus cvcColorSquare" status="STATUS_UNDEFINED" title="未定义"></div>
                </div>
                -->
            </div>




            <div class="__template__" type="TASK_EDITOR">
                <!--
                  <div class="ganttTaskEditor">
                    <h1 class="taskData">编辑任务</h1>
                    <table  cellspacing="1" cellpadding="5" width="100%" class="taskData table" border="0">
                      <td colspan="3" valign="top"><label for="name" class="required">名称</label><br><input type="text" name="name" id="name"class="formElements bold" autocomplete='off' maxlength=255 style='width:100%' value="" required="true" oldvalue="1"></td>
                      <tr>
                        <td style="width: 33%; height: 70px" valign="top">
                          <label for="code">代码</label><br>
                          <input type="text" name="code" id="code" value="" size=15 class="formElements" autocomplete='off' maxlength=255 style='width:100%' oldvalue="1">
                        </td>
                        <td style="width: 33%; height: 70px" valign="top">
                          <label for="type_txt" class=" ">类型</label><br><input type=text name="type_txt" id="type_txt" size=15 class="formElements smartCombo" autocomplete='off' maxlength=255  autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,false );" onKeyDown="manageKeyEvent ($(this),event,false,false);" onKeyPress="stopKeyEvent(event);" value="" ><span class="teamworkIcon menuArrow"  style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="type" id="type" size=10 class="formElements" autocomplete='off' maxlength=255  jspPart='partSmartCombo' value="" oldValue='1' >

                        </td>
                        <td style="width: 33%; height: 70px" valign="top">


                <label for="domId_35083210">状态</label><br> <div class="cvcComponent cvcDisplayValue cvcShowOpener " style="cursor:pointer;" cvcType="STATUS" displayValue='true'> <input type=hidden name="status" id="status" size=2 class="formElements" autocomplete='off' maxlength=255 value="STATUS_ACTIVE" oldValue='1' ><div class="cvcColorSquare"   onClick="cvc_clickColValSel($(this),event);" ><div class="cvcStatuses ellipsis"><div class="cvcSelBox " title="进行中" code="STATUS_ACTIVE"
                         style=" color:#FFFFFF;background-color:#3BBF67"><span class="cvcDescription">进行中</span></div></div><span class="teamworkIcon menuArrow">&ugrave;</span>
                  </div>

                </div>

                        </td>
                      </tr>

                      <tr class="dateRow">
                        <td nowrap="">
                          <div style="position:relative">
                            <label for="start">开始日期</label>&nbsp;&nbsp;&nbsp;&nbsp;
                            <input type="checkbox" id="startIsMilestone" name="startIsMilestone" value="yes"> &nbsp;<label for="startIsMilestone">作为里程碑</label>&nbsp;
                            <br>
                <input type=text name="start" id="start" size=8 class="formElements dateField validated date" autocomplete='off' maxlength=255  onchange ="$(this).oneTime(100,'dfblur',function(){if ($(this).is('.formElementsError')) {$(this).focus();} });"  format="yyyy-M-d" value="" oldValue='1' entryType="DATE" maxValue="3020-11-20" minValue="1020-10-30" ><span title="日历" id="starts_inputDate" class="teamworkIcon openCalendar"
                  onclick="var inp=$(this).prevAll(':input:first');$(this).dateField({inputField:inp,dateFormat:inp.attr('format'),isSearchField:false,minDate:inp.attr('minValue'),maxDate:inp.attr('maxValue'),disableHolidays:true});">m</span>

                 </div></td>
                        <td nowrap="">
                          <label for="end">结束日期</label>&nbsp;&nbsp;&nbsp;&nbsp;
                          <input type="checkbox" id="endIsMilestone" name="endIsMilestone" value="yes"> &nbsp;<label for="endIsMilestone">作为里程碑</label>&nbsp;
                          <br>
                <input type=text name="end" id="end" size=8 class="formElements dateField validated date" autocomplete='off' maxlength=255  onchange ="$(this).oneTime(100,'dfblur',function(){if ($(this).is('.formElementsError')) {$(this).focus();} });"  format="yyyy-M-d" value="" oldValue='1' entryType="DATE" maxValue="3020-11-20" minValue="1020-10-30" ><span title="日历" id="ends_inputDate" class="teamworkIcon openCalendar"
                  onclick="var inp=$(this).prevAll(':input:first');$(this).dateField({inputField:inp,dateFormat:inp.attr('format'),isSearchField:false,minDate:inp.attr('minValue'),maxDate:inp.attr('maxValue'),disableHolidays:true});">m</span>

                </td>
                        <td nowrap="" >
                          <label for="duration" class=" ">天</label><br>
                          <input type="text" name="duration" id="duration" size="4" class="formElements validated durationdays" title="Duration is in working days." autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DURATIONDAYS">&nbsp;
                        </td>
                      </tr>

                      <tr>
                        <td valign="top">
                          <label for="relevance" class=" ">重要性</label><br>
                          <input type="text" name="relevance" id="relevance" size="7" class="formElements validated percentile" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="PERCENTILE">
                        </td>

                        <td valign="top" nowrap >
                          <label>进度</label><br>
                          <input type="text" name="progress" id="progress" size="3" class="formElements validated percentile" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="PERCENTILE">
                          <SELECT NAME="progressComputeType"  id="progressComputeType"  onChange="$('#progress').attr('readonly',$(this).val()!='0')" CLASS="formElements" oldValue='1'>
                <option value="0">手册</option>
                <option value="1">通过工作日志/估计</option>
                <option value="3">由子任务（加权）</option>
                <option value="2">由子任务完成/总计</option>
                <option value="4">by issue closed / total</option>
                <option value="5">by issue weight (closed..</option>
                <option value="7">按成本/估计</option>
                <option value="8">按成本/预算</option>
                <option value="6">按日期</option>
                </SELECT>
                        </td>
                        <td valign="top" nowrap >
                          <label for="color">颜色</label><br>
                    <span class="colorChooserGroup"><input type=text name="color" id="color" size=2 class="formElements colorChooserField" autocomplete='off' maxlength=255 value="" oldValue='1' >
                    </span>
                <script type="text/javascript">

                  var defs = [
                    initialize(contextPath + "/commons/js/jquery/spectrum/spectrum.css?_=65022", "css"),
                    initialize(contextPath + "/commons/js/jquery/spectrum/tw_spectrum.css?_=65022", "css"),
                    initialize(contextPath + "/commons/js/jquery/spectrum/spectrum.js?_=65022", "script")
                  ];

                  $.when.apply(null, defs).done(function () {
                    /*
                     SPECTRUM color chooser
                     https://bgrins.github.io/spectrum/#why-customizable

                     color: tinycolor,
                     flat: bool,
                     showInput: bool,
                     showInitial: bool,
                     allowEmpty: bool,
                     showAlpha: bool,
                     disabled: bool,
                     localStorageKey: string,
                     showPalette: bool,
                     showPaletteOnly: bool,
                     togglePaletteOnly: bool,
                     showSelectionPalette: bool,
                     clickoutFiresChange: bool,
                     cancelText: string,
                     chooseText: string,
                     togglePaletteMoreText: string,
                     togglePaletteLessText: string,
                     containerClassName: string,
                     replacerClassName: string,
                     preferredFormat: string,
                     maxSelectionSize: int,
                     palette: [[string]],
                     selectionPalette: [string]
                     */


                      $("#color").spectrum({
                        color: $("#color").val(),
                        allowEmpty: true,
                        palette: [["#464646","#696969","#8C8C8C","#AFAFAF","#D2D2D2","#F5F5F5"],["#CF0B0B","#F22E2E","#FF5151","#FF7474","#FF9797","#FFBABA"],["#FD9812","#FFBB35","#FFDE58","#FFFF7B","#FFFF9E","#FFFFC1"],["#18A106","#3BC429","#5EE74C","#81FF6F","#A4FF92","#C7FFB5"],["#0C40A3","#2F63C6","#5286E9","#75A9FF","#98CCFF","#BBEFFF"],["#9929ED","#BC4CFF","#DF6FFF","#FF92FF","#FFB5FF","#FFD8FF"]],
                        showInput: false,
                        showPaletteOnly: true,
                        showPalette: false,
                        hideAfterPaletteSelect:false,
                        preferredFormat: "hex",

                        show: function(color) {
                          $("#color").spectrum("option", "hideAfterPaletteSelect",  true);

                          if(true){

                            var clearButton = $("<div class='clear-palette' title='Clear color'>删除</div>");
                            clearButton.on("click.spectrum", function (e) {
                              e.preventDefault();
                              e.stopPropagation();
                              $(".sp-clear").click();
                              $("#color").val("").spectrum("hide");
                            });
                            $('.sp-palette').append(clearButton);

                          }
                        }

                      });

                  });
                </script>



                        </td>

                      </tr>

                      <tr>
                        <td colspan="5">
                          <label for="description">描述</label><br>
                          <textarea rows="3" cols="30" id="description" name="description" class="formElements" style="width:100%" oldvalue="1"></textarea>
                        </td>
                      </tr>

                      <tr>
                        <td colspan="5">
                          <label for="tags" class=" ">标签</label><br><input type=text name="tags" id="tags" size=36 class="formElements tagBox" autocomplete='off' maxlength=255 style='width:100%' autocomplete='off' taggableClass="com.twproject.task.Task" maxResult="30" tagPropertyName="tags" areaId="5819" value="" oldValue='1' ></td>

                      </tr>

                    </table>
                    <br>
                    <h2>分工
                    <span style="float: right">
                      <button type="button" class="button noprint icon small lreq20" title="批量分配" onclick="openWorkGroup();return false; ">
                        <span class="teamworkIcon ">r</span>
                      </button>
                    </span>
                    </h2>
                    <table class="table dataTable fixHead">
                      <thead class="dataTableHead">
                      <tr>
                        <th class="tableHead" style="width:340px;">名称</th>
                        <th class="tableHead" style="width:200px;">角色</th>
                        <th class="tableHead" style="width:120px;" colspan="2">预估计划工期</th>
                        <th class="tableHead" style="width:50px; text-align: center" id="addAssig" align="center"><span class="button textual"><span class="teamworkIcon edit">P</span></span></th>
                      </tr>
                      </thead>
                      <tbody id="assigsTable" class="dataTableBody"></tbody>

                      <tfoot>
                      <tr><td id="bulkPlace" colspan="99"></td></tr>
                      </tfoot>
                    </table>

                    <div id="bulkOp" style="display:none;">
                      <table class="tableaaa" cellspacing="10"><tr>
                        <td id="bulkRowSel"></td>
                        <td>挑一个角色 </td>
                        <td><select type="select" name="roleId"  class="formElements" style="width:200px;"></td>
                        <td><span class="button small lreq20" onclick="assignRoleToSelected($(this));">执行</span></td>
                        </tr>
                      </table>
                    </div>



                    <div class="buttonArea" style="padding: 10px 0">
                      <span id="saveButton" class="button first" onClick="$(this).trigger('saveFullEditor.gantt');">保存</span>

                    </div>
                  </div>
                  -->
            </div>



            <div class="__template__" type="ASSIGNMENT_ROW">
                <!--
                  <tr taskId="(#=obj.task.id#)" assId="(#=obj.assig.id#)" class="assigEditRow" >

                    <td style="width:340px;"><script>
                      function letSubmitresourceId() {
                        updateResourceLoad($(this));
                      }
                    </script><input type=text name="resourceId_txt" id="resourceId_txt" size=40 class="formElements smartCombo" autocomplete='off' maxlength=255  autocomplete="off" onfocus="createDropDown($(this),400,100); refreshDropDown ($(this).nextAll('.cbDropDown'),$(this)); setSelection(this,0,1024)" onblur="finalizeOperation($(this).nextAll('.cbDropDown:first'),false,false );" style="width:310px"  onKeyDown="manageKeyEvent ($(this),event,false,false);" onKeyPress="stopKeyEvent(event);" value="(#!getResource(obj.assig).name#)" ><span class="teamworkIcon menuArrow"  style='cursor:pointer; margin-left: -15px' onClick="if ( $(this).prevAll('.cbDropDown:first').size()<=0) {$(this).prevAll('input:text:first').focus();} " style="">&ugrave;</span><input type=hidden name="resourceId" id="resourceId" size=10 class="formElements" autocomplete='off' maxlength=255  jspPart='partSmartCombo' value="(#!getResource(obj.assig).id#)" oldValue='1' >
                </td>
                    <td style="width:200px;"><select type="select" name="roleId"  class="formElements" style="width:200px;"></select></td>
                    <td style="width:70px;"><input type="text" name="effort" value="(#=getMillisInHoursMinutes(obj.assig.effort)#)"  onchange="updateResourceLoad($(this));" size="5" class="formElements"></td>
                    <td style="width:50px;" class="workloadInfo" align="center"></td>
                    <td style="width:50px;" align="center"><span class="button icon textual delAssig del delete"><span class="teamworkIcon">d</span></span></td>
                  </tr>
                  -->
            </div>
        </div>



        <div id="taskRowMenu" class="divomo" style=" position: absolute;left:-10000px; top:-10000px;">
            <div class="divomoArrow"></div>
            <div>
                <button type="button" class="button noprint textual   " id="domId_244722674" style="" onclick="ge.element.trigger('openFullEditor.gantt');return false; ">编辑</button>


                <button type="button" class="button noprint textual   " id="domId_529228313" style="" onclick="ge.element.trigger('openAssignmentEditor.gantt');return false; ">分工</button>


                <hr>
                <div class="noShowIfNew">
                    <button type="button" class="button noprint textual   " id="domId_1534933850" style="" onclick="ge.element.trigger('addIssue.gantt');return false; ">创建问题</button>


                    <button type="button" class="button noprint textual   " id="domId_2059649186" style="" onclick="ge.element.trigger('openExternalEditor.gantt');return false; ">任务数据</button>


                    <button type="button" class="button noprint textual   " id="domId_1234963109" style="" onclick="ge.element.trigger('openTaskLogs.gantt');return false; ">更新/备注</button>


                </div>
            </div>
        </div>

        <div id="LOG_CHANGES_CONTAINER" class="microEdit mbBalloon" onclick="event.stopPropagation();return false;">
            <div style="bottom: -14px; left: 10px;" class="arrow s"></div>
            <div style="bottom: -12px; left: 10px;border-color:#fff" class="arrow border s "></div>
            <h3>注释更改</h3>

            <textarea name="LOG_CHANGES" id="LOG_CHANGES" COLS="25" ROWS="3" class="formElements" style='width:100%;' oldValue='1' maxlength=2000 onKeyUp="limitSize(this);" onKeyDown="limitSize(this);" onBlur="limitSize(this);"></textarea>
        </div>


        <script type="text/javascript">
            function getResource(assig) {
                var ret = { id: 0, name: "" };
                if (assig && assig.resourceId) {
                    ret = ge.getResource(assig.resourceId);
                }
                return ret;
            }


            function openWorkGroup() {
                //WG_IDS, WG_CAND_IDS
                var taskEditor = $(".ganttTaskEditor");
                var wgIds = [];
                taskEditor.find(":input[name=resourceId]").each(function () {
                    var inp = $(this);
                    if (inp.val()) {
                        wgIds.push(inp.val());
                    }
                });
                var url = contextPath + "/app/workgroup/workgroupPopup.html?" +
                    "useCallbackFunction=yes&" +
                    "title=" + encodeURIComponent("批量分配") + "&" +
                    "WG_IDS=" + encodeURIComponent(wgIds.join()) + "&" +
                    "PERM_REQUIRED=TW_ass_man";
                openBlackPopup(url, 700, 580, function (selectedResources) {
                    //console.debug("wgCallback",selectedResources);
                    if (selectedResources) {
                        //si eliminano le righe vuote
                        taskEditor.find(":input[name=resourceId]").each(function () {
                            var inp = $(this);
                            if (parseInt(inp.val()) == 0) {
                                inp.closest("tr").remove();
                            }
                        });

                        var assigsTable = taskEditor.find("#assigsTable");

                        var row;
                        for (var i = 0; i < selectedResources.length; i++) {
                            var res = selectedResources[i];
                            //si deve controllare se c'è già
                            var found = false;
                            taskEditor.find(":input[name=resourceId]").each(function () {
                                var inp = $(this);
                                if (res.id == inp.val()) {
                                    found = true;
                                    return false;
                                }
                            });

                            //se la risorsa non c'è già la aggiungo
                            if (!found) {
                                var assigRow = $.JST.createFromTemplate({ task: ge.currentTask, assig: { id: "tmp_" + new Date().getTime() + "_" + i } }, "ASSIGNMENT_ROW");
                                assigRow.find("[name=resourceId_txt]").val(res.displayName);
                                assigRow.find("[name=resourceId]").val(res.id);
                                assigsTable.append(assigRow);
                                updateResourceLoad(assigRow.children().eq(0))
                            }
                        }
                    }
                });
            }


            $.JST.loadDecorator("ASSIGNMENT_ROW", function (assigTr, taskAssig) {
                var roleEl = assigTr.find("[name=roleId]");
                for (var i in taskAssig.task.master.roles) {
                    var role = taskAssig.task.master.roles[i];
                    var optr = $("<option>");
                    optr.val(role.id).html(role.name + (role.area ? " (" + role.area + ")" : ""));
                    if (taskAssig.assig.roleId == role.id)
                        optr.attr("selected", "true");
                    roleEl.append(optr);
                }

                if (taskAssig.task.master.permissions.canWrite || taskAssig.task.canWrite) {
                    assigTr.find(".delAssig").click(function () {
                        var tr = $(this).closest("[assId]").fadeOut(200, function () { $(this).remove() });
                    });
                }
            });


            function loadI18n() {
                GanttMaster.taskStatusDecoder = {
                    "STATUS_ACTIVE": { "label": "进行中", "color": "#3BBF67", "contrastColor": "#FFFFFF", "rgb": { "r": 59, "g": 191, "b": 103 } },
                    "STATUS_WAITING": { "label": "等候", "color": "#F79136", "contrastColor": "#FFFFFF", "rgb": { "r": 247, "g": 145, "b": 54 } },
                    "STATUS_SUSPENDED": { "label": "暂停", "color": "#F9C154", "contrastColor": "#000000", "rgb": { "r": 249, "g": 193, "b": 84 } },
                    "STATUS_DONE": { "label": "完成", "color": "#6EBEF4", "contrastColor": "#000000", "rgb": { "r": 110, "g": 190, "b": 244 } },
                    "STATUS_FAILED": { "label": "失败", "color": "#763A96", "contrastColor": "#FFFFFF", "rgb": { "r": 118, "g": 58, "b": 150 } },
                    "STATUS_UNDEFINED": { "label": "未定义", "color": "#dededf", "contrastColor": "#000000", "rgb": { "r": 222, "g": 222, "b": 223 } }
                };

                GanttMaster.messages = {

                    "STATUS_ACTIVE": "进行中",

                    "STATUS_WAITING": "等候",

                    "STATUS_SUSPENDED": "暂停",

                    "STATUS_DONE": "完成",

                    "STATUS_FAILED": "失败",

                    "STATUS_UNDEFINED": "未定义",


                    "CANNOT_WRITE": "没有权限更改以下任务",
                    "CHANGE_OUT_OF_SCOPE": "我没有更新父项目的权限，我无法更新项目。",
                    "START_IS_MILESTONE": "起始日期是一个重要的步骤。",
                    "END_IS_MILESTONE": "结束日期是一个重要的步骤。",
                    "TASK_HAS_CONSTRAINTS": "是有限制的任务。",
                    "GANTT_ERROR_DEPENDS_ON_OPEN_TASK": "有一个依赖的活动任务的错误。",
                    "GANTT_ERROR_DESCENDANT_OF_CLOSED_TASK": "发生错误，因为子任务的任务：关闭错误。",
                    "TASK_HAS_EXTERNAL_DEPS": "我们的任务是外部的依赖。",
                    "GANNT_ERROR_LOADING_DATA_TASK_REMOVED": "GANNT_ERROR_LOADING_DATA_TASK_REMOVED",
                    "CIRCULAR_REFERENCE": "循环引用",
                    "CANNOT_DEPENDS_ON_ANCESTORS": "我可以不依赖于祖先。",
                    "INVALID_DATE_FORMAT": "插入数据字段的格式无效。",
                    "GANTT_ERROR_LOADING_DATA_TASK_REMOVED": "加载数据时发生了错误。任务已丢弃。",
                    "CANNOT_CLOSE_TASK_IF_OPEN_ISSUE": "Cannot close a task with open issues",
                    "TASK_MOVE_INCONSISTENT_LEVEL": "我将无法更换不同层次的任务。",
                    "GANTT_SEMESTER_SHORT": "学期",
                    "GANTT_SEMESTER": "学期",
                    "GANTT_QUARTER_SHORT": "季",
                    "GANTT_QUARTER": "25美分硬币",
                    "GANTT_WEEK_SHORT": "周",
                    "GANTT_WEEK": "GANTT_WEEK",
                    "CANNOT_MOVE_TASK": "无法移动任务",
                    "PLEASE_SAVE_PROJECT": "请保存项目。",
                    "CANNOT_CREATE_SAME_LINK": "这个依赖已经存在"
                };
            }




            function createNewResource(el) {
                var row = el.closest("tr[taskid]");
                var name = row.find("[name=resourceId_txt]").val();
                var url = contextPath + "/applications/teamwork/resource/resourceNew.jsp?CM=ADD&name=" + encodeURI(name);

                openBlackPopup(url, 700, 320, function (response) {
                    //fillare lo smart combo
                    if (response && response.resId && response.resName) {
                        //fillare lo smart combo e chiudere l'editor
                        row.find("[name=resourceId]").val(response.resId);
                        row.find("[name=resourceId_txt]").val(response.resName).focus().blur();

                        //se è stata creato un login si comunicano i dati
                        if (response.loginCreatedMessage)
                            showFeedbackMessage("INFO", response.loginCreatedMessage);

                    }
                })
            }


            function taskTypeAddedCallback(taskType) {
                //console.debug("taskTypeAddedCallback",taskType)
                if (taskType) {
                    $("#type").val(taskType.id);
                    $("#type_txt").val(taskType.name).blur();
                }

            }
        </script>


        <style>
            .historyOn tr.taskEditRow, .historyOn svg.taskBox:not(.baseline) { pointer-events: none; }
                .historyOn tr.taskEditRow .exp-controller { pointer-events: auto; }
                .historyOn tr.taskEditRow th.edit .teamworkIcon { opacity: .3; }
        </style>


    </div>



    <div class="rightColumn noprint">
        <div class="tools">
            <div class="toolsElement">
                <span class="menuArrow" onclick="bjs_showMenuDiv('divdomo_domId_1854229898', 'domId_1878886998');  ">
                    <button type="button" class="button noprint    first" id="domId_1878886998" style="" title="添加" onclick=";return false; "><span class='teamworkIcon withLabel'>P</span>添加...</button>


                </span>

                <div id="divdomo_domId_1854229898" class="divomo "
                     style=" position: absolute;left:-10000px; top:-10000px;">

                    <div class="divomoArrow"></div>

                    <div>
                        <button type="button" class="button noprint textual   " id="domId_1906694069" style="" onclick="$('#workSpace').trigger('addBelowCurrentTask.gantt');return false; ">+ 添加子任务</button>

                        <button type="button" class="button noprint textual   " id="domId_1056237149" style="" onclick="$('#workSpace').trigger('addAboveCurrentTask.gantt');return false; ">+ 添加同级任务</button>

                    </div>
                </div>
            </div><div class="toolsElement">
                <span class="menuArrow" onclick="bjs_showMenuDiv('divdomo_domId_610976960', 'domId_717482695');  ">
                    <button type="button" class="button noprint  icon  " id="domId_717482695" style="" title="进口/出口" onclick=";return false; "><span class='teamworkIcon '>I</span></button>


                </span>

                <div id="divdomo_domId_610976960" class="divomo "
                     style=" position: absolute;left:-10000px; top:-10000px;">

                    <div class="divomoArrow"></div>

                    <div>
                        <a class="button  textual   lreq20 lreqLabel" id="domId_1534467106" style="" href="/applications/teamwork/task/taskExportMPX.jsp?V_ID=2069027980&CM=ED&OBJID=53595" target="_blank">MPX 格式</a>

                        <a class="button  textual   lreq20 lreqLabel" id="domId_657533719" style="" href="/applications/teamwork/task/taskExportXML.jsp?V_ID=205134512&CM=ED&OBJID=53595" target="_blank">XML 格式</a>

                        <a class="button  textual   " id="domId_218367771" style="" href="/applications/teamwork/task/taskExportJSON.jsp?V_ID=2105194955&CM=ED&OBJID=53595" target="_blank">导出到JSON</a>

                        <a class="button  textual   " id="domId_57574474" style="" href="/applications/teamwork/task/ganttExportExcel.jsp?V_ID=2127839306&CM=ED&OBJID=53595" target="_blank">甘特图导出到Excel</a>

                    </div>
                </div>
            </div><div class="toolsElement">
                <span class="menuArrow" onclick="bjs_showMenuDiv('divdomo_domId_1793857269', 'domId_550042451');  ">
                    <button type="button" class="button noprint  icon  " id="domId_550042451" style="" title="打印" onclick=";return false; "><span class='teamworkIcon '>p</span></button>


                </span>

                <div id="divdomo_domId_1793857269" class="divomo "
                     style=" position: absolute;left:-10000px; top:-10000px;">

                    <div class="divomoArrow"></div>

                    <div>
                        <button type="button" class="button noprint textual   " id="domId_877892982" style="" onclick="openBlackPopup('/applications/teamwork/task/taskEditorPrint.jsp?V_ID=836199850&CM=ED&OBJID=53595',$(window).width()-100,$(window).height()-50);return false; ">打印/导出 报告</button>

                        <a class="button  textual   " id="domId_168982171" style="" href="/commons/tools/freezePDF.jsp?V_ID=1639971414&CM=ED&OBJID=53595&PRINTING_PDF=yes&PAGE_TO_PRINT=%2Fapplications%2Fteamwork%2Ftask%2FtaskEditorPrint.jsp&PRINT_TASK_ASSIGS_SUBTASKS=yes&PRINT_TASK_DESCENDANTS=yes&PRINT_TASK_DIARY_DETAIL=yes&REDIR_URL=%2Fapplications%2Fteamwork%2Ftask%2FtaskOverview.jsp%3FV_ID%3D1534693584%26CM%3DCREATE_SNAPSHOT%26OBJID%3D53595&FREEZE_PREFIX=task_53595">快照</a>

                        <hr><button type="button" class="button noprint textual   lreq30 lreqLabel" id="domId_1109966663" style="" onClick="stopBubble(event);saveFormValues('d474471059');  obj('d474471059CM').value='ED';obj('d474471059reportName').value='projectProgress';obj('d474471059').target='_blank'; obj('d474471059').action='/applications/teamwork/task/taskIReportHelper.jsp'; try {obj('d474471059').submit();} catch(e){};restoreFormValues('d474471059');  ">project  progress</button>

                    </div>
                </div>
            </div>
        </div><div class="rightColumnInner">
            <div class="" style="display:block">
                <br><button type="button" class="button noprint textual   bolder lreq20 lreqLabel lreqActive" id="domId_819878477" style="" onclick="openBlackPopup('/applications/teamwork/task/taskClone.jsp?V_ID=1430469406&CM=ED&OBJID=53595&POP=yes','800px','650px');return false; "><span class='teamworkIcon withLabel'>D</span>复制</button>

                <button type="button" class="button noprint textual   bolder" id="domId_1662921441" style="" onclick="openBlackPopup('/applications/teamwork/task/taskMove.jsp?V_ID=882117126&CM=ED&OBJID=53595&POP=yes','700px','450px');return false; "><span class='teamworkIcon withLabel'>y</span>移动</button>

            </div>

            <div class="" style="display:block" id="tskSidBarMoreDiv">

                <div class="separator"></div>
                <a class="button  textual   " id="domId_1368476829" style="" href="/applications/teamwork/task/scrum/sprintWizard.jsp?V_ID=454909916&CM=NEW_SPRINT&PARENT_ID=53595"><span class="teamworkIcon withLabel" style="">P</span> 启动一个新的“冲刺”</a>
                <a class="button  textual   lreq30 lreqLabel lreqHide" id="domId_629174892" style="" href="/applications/teamwork/processes/createProcess.jsp?V_ID=1393492477&CM=AD&PARENT_ID=53595"><span class="teamworkIcon withLabel" style="">P</span> 添加一个子进程</a>
                <button type="button" class="button noprint textual   " id="domId_469701827" style="" onclick="openBlackPopup('/applications/teamwork/task/taskAddFromTemplate.jsp?V_ID=2118890404&CM=ED&OBJID=53595','800px','650px');return false; "><span class="teamworkIcon withLabel" style="">P</span> 从添加模板</button>
                <div class="separator"></div><a class="button  textual   " id="domId_128720017" style="" href="/applications/teamwork/task/worklog/worklogList.jsp?V_ID=1971894978&CM=FN&TASK=53595&TASK_WORKLOG_SHOW_CHILDREN=yes">工作记录分析</a>
                <button type="button" class="button noprint textual   " id="domId_1839829681" style="" onclick="openBlackPopup('/applications/teamwork/task/worklog/worklogInPeriodForTask.jsp?V_ID=1671254742&CM=ED&OBJID=53595','800px','800px');return false; ">当前工作记录</button>
                <div class="separator"></div><button type="button" class="button noprint textual   lreq20 lreqLabel lreqActive" id="domId_24365988" style="" onclick="openBlackPopup('/applications/teamwork/task/taskPublicPageEditor.jsp?V_ID=1731200113&CM=TASK_EDIT_SECURITY&OBJID=53595','800px','600px');return false; ">项目的公共页面</button>
                <button type="button" class="button noprint textual   " id="domId_1497267386" style="" onclick="openTaskImageEditor('53595');return false; ">选择一个项目形象</button>

                <script type="text/javascript">
                    function openTaskImageEditor(resId) {
                        $(".uploadizeDrop").attr("disabled", "true");
                        openBlackPopup(contextPath + "/applications/teamwork/task/taskImageUploader.jsp?TASK_ID=" + 53595, '500px', '550px', function (response) {

                        });
                    }

                </script>
                <button type="button" class="button noprint textual   " id="domId_458144834" style="" onclick="openBlackPopup('/applications/teamwork/task/recodeTaskTree.jsp?V_ID=359580956&CM=ED&OBJID=53595','500px','400px');return false; ">分配新码</button>

                <div class="separator"></div><button type="button" class="button noprint textual   " id="domId_243907040" style="" onclick="openBlackPopup('/applications/teamwork/task/taskArea.jsp?V_ID=1311350543&CM=TASK_EDIT_SECURITY&OBJID=53595','600px','600px');return false; ">安全</button>

            </div>
        </div>
    </div>


</div>

